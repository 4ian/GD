{"version":3,"sources":["Export/LocalExporters/LocalFileSystem.js","ProjectsStorage/LocalFileStorageProvider/LocalProjectWriter.js","ProjectCreation/LocalStarters.js","ResourcesList/LocalResourceSources.js","ResourcesList/LocalResourceExternalEditors.js","ResourcesList/LocalPiskelBridge.js","ResourcesList/LocalJfxrBridge.js","ResourcesList/LocalYarnBridge.js","Export/LocalExporters/LocalPreviewLauncher/index.js","Export/LocalExporters/LocalPreviewLauncher/LocalNetworkPreviewDialog.js","Export/LocalExporters/LocalPreviewLauncher/LocalIpFinder.js","Export/LocalExporters/index.js","Export/LocalExporters/LocalCordovaExport.js","Export/LocalExporters/LocalElectronExport.js","Export/LocalExporters/LocalHTML5Export.js","Export/LocalExporters/LocalCocos2dExport.js","Export/LocalExporters/LocalFacebookInstantGamesExport.js","UI/LocalFilePicker/index.js","Export/LocalExporters/LocalOnlineCordovaExport.js","Export/LocalExporters/LocalOnlineElectronExport.js","Export/LocalExporters/LocalOnlineWebExport.js","MainFrame/ElectronMainMenu.js","JsExtensionsLoader/LocalJsExtensionsLoader.js","JsExtensionsLoader/LocalJsExtensionsFinder.js","EventsFunctionsExtensionsLoader/CodeWriters/LocalEventsFunctionCodeWriter.js","EventsFunctionsExtensionsLoader/Storage/LocalEventsFunctionsExtensionWriter.js","EventsFunctionsExtensionsLoader/Storage/LocalEventsFunctionsExtensionOpener.js","GameEngineFinder/LocalGDJSDevelopmentWatcher.js","UI/LocalFolderPicker/index.js","Utils/LocalArchiver.js","Export/LocalExporters/LocalFileUploader.js","ProjectsStorage/LocalFileStorageProvider/LocalProjectOpener.js","ProjectsStorage/LocalFileStorageProvider/index.js","LocalApp.js","ProjectCreation/LocalExamples.js","ProjectCreation/LocalExamplesFinder.js","ProjectCreation/LocalPathFinder.js","Utils/ObjectSplitter.js"],"names":["fs","optionalRequire","path","os","gd","global","mkDir","mkdirsSync","e","console","log","dirExists","existsSync","clearDir","that","this","readdirSync","forEach","file","curPath","lstatSync","isDirectory","unlinkSync","getTempDir","tmpdir","fileNameFrom","fullpath","_isExternalURL","_translateURL","basename","dirNameFrom","dirname","makeAbsolute","filename","baseDirectory","isAbsolute","resolve","normalize","makeRelative","relative","length","charAt","copyFile","source","dest","copySync","writeToFile","contents","outputFileSync","readFile","readFileSync","toString","readDir","ext","toUpperCase","output","VectorString","indexOf","push_back","fileExists","statSync","isFile","substr","electron","dialog","remote","writeJSONFile","object","filePath","Promise","reject","Error","content","JSON","stringify","ensureDir","then","writeFile","err","stringifyException","writeProjectFiles","project","projectPath","serializedProjectObject","serializeToJSObject","isFolderProject","partialObjects","split","pathSeparator","getArrayItemReferenceName","getSlugifiedUniqueNameFromProperty","shouldSplit","splitPaths","Set","isReferenceMagicPropertyName","all","map","partialObject","join","reference","catch","error","onSaveProject","fileMetadata","fileIdentifier","wasSaved","onSaveProjectAs","defaultPath","fileSystem","assignIn","AbstractFileSystemJS","localFileSystem","browserWindow","getCurrentWindow","options","filters","name","extensions","showSaveDialogSync","ProjectResourcesCopier","copyAllResourcesTo","setProjectFile","onAutoSaveProject","autoSavePath","app","LocalStarters","Component","state","outputPath","findEmptyPath","getPath","_handleChangePath","setState","createFromExample","i18n","exampleName","findExamples","examplesPath","showGameFileCreationError","props","onOpen","LocalFileStorageProvider","sendNewGameCreated","createEmptyGame","ProjectHelper","createNewGDJSProject","onCreate","render","noMargin","expand","leftIcon","iconSize","src","primaryText","secondaryText","secondaryTextLines","onClick","alignItems","justifyContent","label","onShowExamples","fullWidth","value","onChange","type","displayName","kind","component","chooseResources","multiSelections","getLastUsedPath","setLastUsedPath","title","_","selectLocalResourcePath","resources","resourcePath","audioResource","AudioResource","getProjectFile","setFile","setName","imageResource","ImageResource","fontResource","FontResource","videoResource","VideoResource","jsonResource","JsonResource","properties","push","latestPath","showOpenDialog","filePaths","lastUsedPath","parse","dir","filter","isPathInProjectFolder","confirm","copyAllToProjectFolder","editors","edit","sendExternalEditorOpened","openPiskel","openJfxr","openYarn","ipcRenderer","resourcesLoader","resourceNames","singleFrame","onChangesSaved","extraOptions","resourceName","originalIndex","getLocalResourceFullPath","externalEditorData","removeAllListeners","on","event","outputResources","newAnimationName","metadata","data","pskl","resourcesManager","getResourcesManager","resource","createOrUpdateResource","getResource","setMetadata","send","newFilePath","jfxr","BrowserWindow","LocalPreviewLauncher","React","canDoNetworkPreview","networkPreviewDialogOpen","networkPreviewHost","networkPreviewPort","networkPreviewError","previewGamePath","devToolsOpen","previewBrowserWindowConfig","_subscriptionChecker","_openPreviewBrowserWindow","win","loadURL","webContents","openDevTools","_openPreviewWindow","gamePath","width","getGameResolutionWidth","height","getGameResolutionHeight","useContentSize","getName","backgroundColor","networkPreview","serverParams","port","setTimeout","_checkSubscription","ipAddresses","findLocalIp","root","_prepareExporter","findGDJS","gdjsRoot","info","outputDir","exporter","Exporter","launchLayoutPreview","layout","timeFunction","exportLayoutForPixiPreview","delete","time","launchExternalLayoutPreview","externalLayout","exportExternalLayoutForPixiPreview","checkHasSubscription","ref","subscriptionChecker","onChangeSubscription","id","mode","open","url","onClose","onExport","onRunPreviewLocally","LocalNetworkDialog","actions","key","primary","secondaryActions","cannotBeDismissed","onRequestClose","firstLocalIp","find","ipAddress","getLocalExporters","renderIcon","helpPage","description","exportPipeline","localOnlineCordovaExportPipeline","localOnlineWebExportPipeline","localHTML5ExportPipeline","advanced","localFacebookInstantGamesExportPipeline","localCordovaExportPipeline","localOnlineElectronExportPipeline","localElectronExportPipeline","localCocos2dExportPipeline","experimental","shell","getInitialExportState","getLastCompilationDirectory","canLaunchBuild","exportState","renderHeader","updateExportState","renderLaunchButtonLabel","prepareExporter","context","launchExport","exportOptions","MapStringBoolean","set","exportWholePixiProject","launchResourcesDownload","exportOutput","launchCompression","renderDoneFooter","openExportFolder","openItem","renderGameButton","debugMode","prevState","onToggle","check","toggled","labelPosition","exportWholeCocos2dProject","archiveOutputFilename","message","temporaryOutputDir","archiveLocalFolder","outputFilename","styles","container","position","display","button","marginLeft","textField","flex","LocalFilePicker","PureComponent","onChooseFolder","showSaveDialog","style","undefined","margin","hintText","onlineBuildType","archiveOutputDir","launchUpload","outputFile","getBuildFileUploadOptions","uploadOptions","uploadLocalFile","updateStepProgress","launchOnlineBuild","userProfile","uploadBucketKey","getAuthorizationHeader","profile","buildCordovaAndroid","uid","targets","buildElectron","buildWeb","ElectronMainMenu","componentDidMount","onChooseProject","onCloseProject","onCloseApp","onExportProject","onCreateProject","onOpenProjectManager","onOpenStartPage","onOpenDebugger","onOpenAbout","onOpenPreferences","onOpenLanguage","onOpenProfile","status","setUpdateStatus","_buildAndSendMenuTemplate","componentDidUpdate","prevProps","language","_language","fileTemplate","submenu","accelerator","onClickSendEvent","enabled","isMacLike","editTemplate","role","viewTemplate","windowTemplate","helpTemplate","onClickOpenLink","template","unshift","loadExtension","require","findJsExtensionModules","module","exports","objectsEditorService","objectsRenderingService","filterExamples","loadAllExtensions","extensionModulePaths","extensionModulePath","extensionModule","rethrowException","ex","result","rawError","registerEditorConfigurations","registerInstanceRenderers","JsPlatform","get","extensionsRoot","readdir","extensionFolders","filteredExtensionFolders","folder","extensionFolder","checkIfPathHasJsExtensionModule","extensionFolderPath","jsExtensionModulePath","stat","stats","modulePaths","modulePath","makeLocalEventsFunctionCodeWriter","mkdir","code","getPathFor","codeNamespace","slugs","getIncludeFileFor","writeFunctionCode","functionCodeNamespace","filepath","writeBehaviorCode","behaviorCodeNamespace","LocalEventsFunctionsExtensionWriter","chooseEventsFunctionExtensionFile","writeEventsFunctionsExtension","extension","LocalEventsFunctionsExtensionOpener","readEventsFunctionExtensionFile","encoding","dataObject","readJSONFile","child_process","process","findDevelopmentNewIdeAppPath","developmentElectronAppFolder","cwd","getAllDevelopmentWatchPaths","paths","pathsWithErrors","gdevelopRepositoryRoot","gdjsSourcesRuntimePath","gdExtensionsPath","files","extensionPath","Boolean","extensionDevelopmentWatchPaths","concat","gdjsDevelopmentWatchPaths","importGDJSRuntime","exec","stdout","stderr","onWatchEvent","debounce","eventName","resolvedFilename","LocalGDJSDevelopmentWatcher","shouldWatch","PreferencesContext","values","useGDJSDevelopmentWatcher","stopWatchers","watchers","startTime","performance","now","watchPath","watcher","watch","warn","Object","keys","totalTimeStr","toFixed","close","LocalFolderPicker","_onChooseFolder","_getTitleAndMessage","titleAndMessage","archiver","createWriteStream","archive","zlib","level","pointer","pipe","directory","finalize","localFilePath","onProgress","stepCurrentProgress","stepMaxProgress","onOpenWithPicker","unsplit","getReferencePartialObject","referencePath","maxUnsplitDepth","hasAutoSave","compareLastModified","mtime","getTime","onGetAutoSave","internalName","getFileMetadataFromAppArguments","appArguments","POSITIONAL_ARGUMENTS_KEY","createOperations","getOpenErrorMessage","create","authentification","Window","setUpContextMenu","getArguments","isDev","disableCheckForUpdates","eventsFunctionCodeWriter","eventsFunctionsExtensionWriter","eventsFunctionsExtensionOpener","eventsFunctionsExtensionsState","storageProviders","defaultStorageProvider","currentStorageProviderOperations","useStorageProvider","initialFileMetadataToOpen","Consumer","unsavedChanges","renderMainMenu","renderPreviewLauncher","renderExportDialog","exporters","renderCreateDialog","examplesComponent","LocalExamples","startersComponent","renderGDJSDevelopmentWatcher","storageProviderOperations","resourceSources","localResourceSources","resourceExternalEditors","localResourceExternalEditors","extensionsLoader","makeExtensionsLoader","ObjectsEditorService","ObjectsRenderingService","showWarningBox","exampleNames","onExamplesLoaded","onCreateFromExample","tryPath","onExists","onNoAccess","access","constants","R_OK","cb","appPath","getAppPath","basePath","folderName","generateName","accessSync","createReference","referenceTo","splitObject","currentObject","currentPath","currentReference","Array","isArray","index","itemPath","itemReference","propertyName","propertyPath","propertyReference","unsplitObject","depth","indexOrPropertyName","isReference","has","existingNamesForReference","property","newName","newNameGenerator"],"mappings":"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","file":"static/js/local-app.093d8d62.chunk.js","sourcesContent":["import optionalRequire from '../../Utils/OptionalRequire.js';\nvar fs = optionalRequire('fs-extra');\nvar path = optionalRequire('path');\nvar os = optionalRequire('os');\nconst gd = global.gd;\n\nexport default {\n  mkDir: function(path) {\n    try {\n      fs.mkdirsSync(path);\n    } catch (e) {\n      console.log('mkDir(' + path + ') failed: ' + e);\n      return false;\n    }\n    return true;\n  },\n  dirExists: function(path) {\n    return fs.existsSync(path);\n  },\n  clearDir: function(path) {\n    var files = [];\n    var that = this;\n    if (fs.existsSync(path)) {\n      files = fs.readdirSync(path);\n      files.forEach(function(file) {\n        var curPath = path + '/' + file;\n        if (fs.lstatSync(curPath).isDirectory()) {\n          // recurse\n          that.clearDir(curPath);\n        } else {\n          // delete file\n          fs.unlinkSync(curPath);\n        }\n      });\n    }\n  },\n  getTempDir: function() {\n    return os.tmpdir();\n  },\n  fileNameFrom: function(fullpath) {\n    if (this._isExternalURL(fullpath)) return fullpath;\n\n    fullpath = this._translateURL(fullpath);\n    return path.basename(fullpath);\n  },\n  dirNameFrom: function(fullpath) {\n    if (this._isExternalURL(fullpath)) return '';\n\n    fullpath = this._translateURL(fullpath);\n    return path.dirname(fullpath);\n  },\n  makeAbsolute: function(filename, baseDirectory) {\n    if (this._isExternalURL(filename)) return filename;\n\n    filename = this._translateURL(filename);\n    if (!this.isAbsolute(baseDirectory))\n      baseDirectory = path.resolve(baseDirectory);\n\n    return path.resolve(baseDirectory, path.normalize(filename));\n  },\n  makeRelative: function(filename, baseDirectory) {\n    if (this._isExternalURL(filename)) return filename;\n\n    filename = this._translateURL(filename);\n    return path.relative(baseDirectory, path.normalize(filename));\n  },\n  isAbsolute: function(fullpath) {\n    if (this._isExternalURL(fullpath)) return true;\n\n    if (fullpath.length === 0) return true;\n    fullpath = this._translateURL(fullpath);\n    return (\n      (fullpath.length > 0 && fullpath.charAt(0) === '/') ||\n      (fullpath.length > 1 && fullpath.charAt(1) === ':')\n    );\n  },\n  copyFile: function(source, dest) {\n    //URL are not copied.\n    if (this._isExternalURL(source)) return true;\n\n    source = this._translateURL(source);\n    try {\n      if (source !== dest) fs.copySync(source, dest);\n    } catch (e) {\n      console.log('copyFile(' + source + ', ' + dest + ') failed: ' + e);\n      return false;\n    }\n    return true;\n  },\n  writeToFile: function(file, contents) {\n    try {\n      fs.outputFileSync(file, contents);\n    } catch (e) {\n      console.log('writeToFile(' + file + ', ...) failed: ' + e);\n      return false;\n    }\n    return true;\n  },\n  readFile: function(file) {\n    try {\n      var contents = fs.readFileSync(file);\n      return contents.toString();\n    } catch (e) {\n      console.log('readFile(' + file + ') failed: ' + e);\n      return '';\n    }\n  },\n  readDir: function(path, ext) {\n    ext = ext.toUpperCase();\n    var output = new gd.VectorString();\n    try {\n      var files = [];\n      if (fs.existsSync(path)) {\n        files = fs.readdirSync(path);\n        files.forEach(function(file) {\n          if (\n            ext.length === 0 ||\n            file.toUpperCase().indexOf(ext, file.length - ext.length) !== -1\n          ) {\n            output.push_back(path + '/' + file);\n          }\n        });\n      }\n    } catch (e) {\n      console.log('readDir(' + path + ',' + ext + ') failed: ' + e);\n    }\n\n    return output;\n  },\n  fileExists: function(filename) {\n    filename = this._translateURL(filename);\n    try {\n      const stat = fs.statSync(filename);\n      return stat.isFile();\n    } catch (e) {\n      return false;\n    }\n  },\n  _isExternalURL: function(filename) {\n    return filename.substr(0, 4) === 'http' || filename.substr(0, 4) === 'ftp';\n  },\n  /**\n   * Return the filename associated to the URL on the server, relative to the games directory.\n   * (i.e: Transform g/mydirectory/myfile.png to mydirectory/myfile.png).\n   */\n  _translateURL: function(filename) {\n    if (filename.substr(0, 2) === 'g/' || filename.substr(0, 2) === 'g\\\\')\n      filename = filename.substr(2);\n\n    return filename;\n  },\n};\n","// @flow\nimport { serializeToJSObject } from '../../Utils/Serializer';\nimport { type FileMetadata } from '../index';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport {\n  split,\n  splitPaths,\n  getSlugifiedUniqueNameFromProperty,\n} from '../../Utils/ObjectSplitter';\nimport localFileSystem from '../../Export/LocalExporters/LocalFileSystem';\nimport assignIn from 'lodash/assignIn';\n\nconst gd = global.gd;\n\nconst fs = optionalRequire('fs-extra');\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst writeJSONFile = (object: Object, filePath: string): Promise<void> => {\n  if (!fs) return Promise.reject(new Error('Filesystem is not supported.'));\n\n  try {\n    const content = JSON.stringify(object, null, 2);\n    return fs.ensureDir(path.dirname(filePath)).then(\n      () =>\n        new Promise((resolve, reject) => {\n          fs.writeFile(filePath, content, (err: ?Error) => {\n            if (err) {\n              return reject(err);\n            }\n\n            return resolve();\n          });\n        })\n    );\n  } catch (stringifyException) {\n    return Promise.reject(stringifyException);\n  }\n};\n\nconst writeProjectFiles = (\n  project: gdProject,\n  filePath: string,\n  projectPath: string\n): Promise<void> => {\n  const serializedProjectObject = serializeToJSObject(project);\n\n  if (project.isFolderProject()) {\n    const partialObjects = split(serializedProjectObject, {\n      pathSeparator: '/',\n      getArrayItemReferenceName: getSlugifiedUniqueNameFromProperty('name'),\n      shouldSplit: splitPaths(\n        new Set([\n          '/layouts/*',\n          '/externalLayouts/*',\n          '/externalEvents/*',\n          '/layouts/*',\n          '/eventsFunctionsExtensions/*',\n        ])\n      ),\n      isReferenceMagicPropertyName: '__REFERENCE_TO_SPLIT_OBJECT',\n    });\n\n    return Promise.all(\n      partialObjects.map(partialObject => {\n        return writeJSONFile(\n          partialObject.object,\n          path.join(projectPath, partialObject.reference) + '.json'\n        ).catch(err => {\n          console.error('Unable to write a partial file:', err);\n          throw err;\n        });\n      })\n    ).then(() => {\n      return writeJSONFile(serializedProjectObject, filePath).catch(err => {\n        console.error('Unable to write the split project:', err);\n        throw err;\n      });\n    });\n  } else {\n    return writeJSONFile(serializedProjectObject, filePath).catch(err => {\n      console.error('Unable to write the project:', err);\n      throw err;\n    });\n  }\n};\n\nexport const onSaveProject = (\n  project: gdProject,\n  fileMetadata: FileMetadata\n): Promise<{|\n  wasSaved: boolean,\n  fileMetadata: FileMetadata,\n|}> => {\n  const filePath = fileMetadata.fileIdentifier;\n  if (!filePath) {\n    return Promise.reject(\n      'Project file is empty, \"Save as\" should have been called?'\n    );\n  }\n\n  const projectPath = path.dirname(filePath);\n  return writeProjectFiles(project, filePath, projectPath).then(() => {\n    return { wasSaved: true, fileMetadata }; // Save was properly done\n  });\n};\n\nexport const onSaveProjectAs = (\n  project: gdProject,\n  fileMetadata: ?FileMetadata\n): Promise<{|\n  wasSaved: boolean,\n  fileMetadata: ?FileMetadata,\n|}> => {\n  const defaultPath = fileMetadata ? fileMetadata.fileIdentifier : '';\n  const fileSystem = assignIn(new gd.AbstractFileSystemJS(), localFileSystem);\n  const browserWindow = electron.remote.getCurrentWindow();\n  const options = {\n    defaultPath,\n    filters: [{ name: 'GDevelop 5 project', extensions: ['json'] }],\n  };\n\n  if (!dialog) {\n    return Promise.reject('Unsupported');\n  }\n  const filePath = dialog.showSaveDialogSync(browserWindow, options);\n  if (!filePath) {\n    return Promise.resolve({ wasSaved: false, fileMetadata });\n  }\n  const projectPath = path.dirname(filePath);\n\n  // TODO: Ideally, errors while copying resources should be reported.\n  gd.ProjectResourcesCopier.copyAllResourcesTo(\n    project,\n    fileSystem,\n    projectPath,\n    true, // Update the project with the new resource paths\n    false, // Don't move absolute files\n    true // Keep relative files folders structure.\n  );\n\n  // Update the project with the new file path (resources have already been updated)\n  project.setProjectFile(filePath);\n\n  return writeProjectFiles(project, filePath, projectPath).then(() => {\n    return {\n      wasSaved: true,\n      fileMetadata: {\n        ...fileMetadata,\n        fileIdentifier: filePath,\n      },\n    }; // Save was properly done\n  });\n};\n\nexport const onAutoSaveProject = (\n  project: gdProject,\n  fileMetadata: FileMetadata\n) => {\n  const autoSavePath = fileMetadata.fileIdentifier + '.autosave';\n  writeJSONFile(serializeToJSObject(project), autoSavePath).catch(err => {\n    console.error(`Unable to write ${autoSavePath}:`, err);\n    throw err;\n  });\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport { I18n } from '@lingui/react';\nimport { type I18n as I18nType } from '@lingui/core';\nimport React, { Component } from 'react';\nimport Divider from '@material-ui/core/Divider';\nimport RaisedButton from '../UI/RaisedButton';\nimport LocalFolderPicker from '../UI/LocalFolderPicker';\nimport Text from '../UI/Text';\nimport { sendNewGameCreated } from '../Utils/Analytics/EventSender';\nimport { Column, Line } from '../UI/Grid';\nimport { List, ListItem } from '../UI/List';\nimport { findExamples } from './LocalExamplesFinder';\nimport optionalRequire from '../Utils/OptionalRequire.js';\nimport { findEmptyPath } from './LocalPathFinder';\nimport ListIcon from '../UI/ListIcon';\nimport { showGameFileCreationError } from './LocalExamples';\nimport { type StorageProvider, type FileMetadata } from '../ProjectsStorage';\nimport LocalFileStorageProvider from '../ProjectsStorage/LocalFileStorageProvider';\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst app = electron ? electron.remote.app : null;\nvar fs = optionalRequire('fs-extra');\nconst gd = global.gd;\n\ntype Props = {|\n  onOpen: (\n    storageProvider: StorageProvider,\n    fileMetadata: FileMetadata\n  ) => void,\n  onCreate: (\n    gdProject,\n    storageProvider: ?StorageProvider,\n    fileMetadata: ?FileMetadata\n  ) => void,\n  onShowExamples: () => void,\n|};\n\ntype State = {|\n  outputPath: string,\n|};\n\nexport default class LocalStarters extends Component<Props, State> {\n  state = {\n    outputPath: findEmptyPath(\n      path && app\n        ? path.join(app.getPath('documents'), 'GDevelop projects')\n        : ''\n    ),\n  };\n\n  _handleChangePath = (outputPath: string) =>\n    this.setState({\n      outputPath,\n    });\n\n  createFromExample(i18n: I18nType, exampleName: string) {\n    const { outputPath } = this.state;\n    if (!fs || !outputPath) return;\n\n    findExamples(examplesPath => {\n      try {\n        fs.mkdirsSync(outputPath);\n        fs.copySync(path.join(examplesPath, exampleName), outputPath);\n      } catch (error) {\n        showGameFileCreationError(i18n, outputPath, error);\n        return;\n      }\n\n      this.props.onOpen(LocalFileStorageProvider, {\n        fileIdentifier: path.join(outputPath, exampleName + '.json'),\n      });\n      sendNewGameCreated(exampleName);\n    });\n  }\n\n  createEmptyGame(i18n: I18nType) {\n    const { outputPath } = this.state;\n    if (!fs || !outputPath) return;\n\n    try {\n      fs.mkdirsSync(outputPath);\n    } catch (error) {\n      showGameFileCreationError(i18n, outputPath, error);\n      return;\n    }\n\n    const project = gd.ProjectHelper.createNewGDJSProject();\n    const filePath = path.join(outputPath, 'game.json');\n    project.setProjectFile(filePath);\n    this.props.onCreate(project, LocalFileStorageProvider, {\n      fileIdentifier: filePath,\n    });\n    sendNewGameCreated('');\n  }\n\n  render() {\n    return (\n      <I18n>\n        {({ i18n }) => (\n          <Column noMargin>\n            <Line>\n              <Column>\n                <Text>\n                  <Trans>Choose a game to use as a starter:</Trans>\n                </Text>\n              </Column>\n            </Line>\n            <Line>\n              <Column expand noMargin>\n                <List>\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/platformer.png\"\n                      />\n                    }\n                    primaryText={<Trans>Platformer</Trans>}\n                    secondaryText={\n                      <Trans>\n                        A simple platform game, with coins to collect, moving\n                        platforms and enemies.\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() => this.createFromExample(i18n, 'platformer')}\n                  />\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/space-shooter.png\"\n                      />\n                    }\n                    primaryText={<Trans>8-bit Space Shooter</Trans>}\n                    secondaryText={\n                      <Trans>\n                        A beautiful, retro side-scrolling shooter where you must\n                        defeat incoming enemies with your mecha transforming\n                        spaceship. Huge boss included!\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() =>\n                      this.createFromExample(i18n, 'space-shooter')\n                    }\n                  />\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/geometry-monster.png\"\n                      />\n                    }\n                    primaryText={<Trans>Geometry Monster</Trans>}\n                    secondaryText={\n                      <Trans>\n                        A hyper casual endless game where you have to collect\n                        shapes and avoid bombs, with a progressively increasing\n                        difficulty.\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() =>\n                      this.createFromExample(i18n, 'geometry-monster')\n                    }\n                  />\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/isometric-game.png\"\n                      />\n                    }\n                    primaryText={<Trans>Isometric game</Trans>}\n                    secondaryText={\n                      <Trans>\n                        An example of an isometric game where you can explore a\n                        map with your character.\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() =>\n                      this.createFromExample(i18n, 'isometric-game')\n                    }\n                  />\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/downhill-bike-physics-demo.png\"\n                      />\n                    }\n                    primaryText=\"Downhill Bike Racing\"\n                    secondaryText={\n                      <Trans>\n                        An example of a 2D physics based game, where players\n                        have to reach the end as fast as possible.\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() =>\n                      this.createFromExample(i18n, 'downhill-bike-physics-demo')\n                    }\n                  />\n                  <ListItem\n                    leftIcon={\n                      <ListIcon\n                        iconSize={40}\n                        src=\"res/starters_icons/pairs.png\"\n                      />\n                    }\n                    primaryText=\"Pairs\"\n                    secondaryText={\n                      <Trans>\n                        Find all matching pairs of cards in this relaxing game.\n                        Use tweens to create smooth, natural animations with a\n                        few events.\n                      </Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() => this.createFromExample(i18n, 'pairs')}\n                  />\n                  <ListItem\n                    primaryText={<Trans>Empty game</Trans>}\n                    secondaryText={\n                      <Trans>Start a new game from scratch.</Trans>\n                    }\n                    secondaryTextLines={2}\n                    onClick={() => this.createEmptyGame(i18n)}\n                  />\n                </List>\n                <Line alignItems=\"center\" justifyContent=\"center\">\n                  <RaisedButton\n                    label={<Trans>See examples</Trans>}\n                    onClick={() => this.props.onShowExamples()}\n                  />\n                </Line>\n              </Column>\n            </Line>\n            <Divider />\n            <Line expand>\n              <Column expand>\n                <LocalFolderPicker\n                  fullWidth\n                  value={this.state.outputPath}\n                  onChange={this._handleChangePath}\n                  type=\"create-game\"\n                />\n              </Column>\n            </Line>\n          </Column>\n        )}\n      </I18n>\n    );\n  }\n}\n","// @flow\nimport { t } from '@lingui/macro';\nimport { type I18n as I18nType } from '@lingui/core';\nimport type { ResourceKind } from './ResourceSource.flow';\nimport { type ResourceSourceComponentProps } from './ResourceSource.flow';\nimport { Component } from 'react';\nimport {\n  isPathInProjectFolder,\n  copyAllToProjectFolder,\n} from './ResourceUtils.js';\nimport optionalRequire from '../Utils/OptionalRequire.js';\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\nconst path = optionalRequire('path');\n\nconst gd = global.gd;\n\nexport default [\n  {\n    name: 'localAudioFileOpener',\n    displayName: 'Choose a new audio file',\n    kind: 'audio',\n    component: class LocalAudioFileOpener extends Component<ResourceSourceComponentProps> {\n      chooseResources = (\n        project: gdProject,\n        multiSelections: boolean = true\n      ): Promise<Array<any>> => {\n        const { i18n, getLastUsedPath, setLastUsedPath } = this.props;\n        const options = {\n          multiSelections,\n          title: i18n._(t`Choose an audio file`),\n          name: i18n._(t`Audio files`),\n          extensions: ['wav', 'mp3', 'ogg'],\n        };\n        return selectLocalResourcePath(\n          i18n,\n          project,\n          options,\n          getLastUsedPath,\n          setLastUsedPath,\n          'audio'\n        ).then(resources => {\n          return resources.map(resourcePath => {\n            const audioResource = new gd.AudioResource();\n            const projectPath = path.dirname(project.getProjectFile());\n            audioResource.setFile(path.relative(projectPath, resourcePath));\n            audioResource.setName(path.relative(projectPath, resourcePath));\n\n            return audioResource;\n          });\n        });\n      };\n\n      render() {\n        return null;\n      }\n    },\n  },\n  {\n    name: 'localFileOpener',\n    displayName: 'Choose a new image',\n    kind: 'image',\n    component: class LocalFileOpener extends Component<ResourceSourceComponentProps> {\n      chooseResources = (\n        project: gdProject,\n        multiSelections: boolean = true\n      ): Promise<Array<any>> => {\n        const { i18n, getLastUsedPath, setLastUsedPath } = this.props;\n        const options = {\n          multiSelections,\n          title: i18n._(t`Choose an image`),\n          name: i18n._(t`Image files`),\n          extensions: ['png', 'jpg'],\n        };\n        return selectLocalResourcePath(\n          i18n,\n          project,\n          options,\n          getLastUsedPath,\n          setLastUsedPath,\n          'image'\n        ).then(resources => {\n          return resources.map(resourcePath => {\n            const imageResource = new gd.ImageResource();\n            const projectPath = path.dirname(project.getProjectFile());\n            imageResource.setFile(path.relative(projectPath, resourcePath));\n            imageResource.setName(path.relative(projectPath, resourcePath));\n\n            return imageResource;\n          });\n        });\n      };\n\n      render() {\n        return null;\n      }\n    },\n  },\n  {\n    name: 'localFontFileOpener',\n    displayName: 'Choose a new font file',\n    kind: 'font',\n    component: class LocalFontFileOpener extends Component<ResourceSourceComponentProps> {\n      chooseResources = (\n        project: gdProject,\n        multiSelections: boolean = true\n      ): Promise<Array<any>> => {\n        const { i18n, getLastUsedPath, setLastUsedPath } = this.props;\n        const options = {\n          multiSelections,\n          title: i18n._(t`Choose a font file`),\n          name: i18n._(t`Font files`),\n          extensions: ['ttf', 'otf'],\n        };\n        return selectLocalResourcePath(\n          i18n,\n          project,\n          options,\n          getLastUsedPath,\n          setLastUsedPath,\n          'font'\n        ).then(resources => {\n          return resources.map(resourcePath => {\n            const fontResource = new gd.FontResource();\n            const projectPath = path.dirname(project.getProjectFile());\n            fontResource.setFile(path.relative(projectPath, resourcePath));\n            fontResource.setName(path.relative(projectPath, resourcePath));\n\n            return fontResource;\n          });\n        });\n      };\n\n      render() {\n        return null;\n      }\n    },\n  },\n  {\n    name: 'localVideoFileOpener',\n    displayName: 'Choose a new video file',\n    kind: 'video',\n    component: class LocalVideoFileOpener extends Component<ResourceSourceComponentProps> {\n      chooseResources = (\n        project: gdProject,\n        multiSelections: boolean = true\n      ): Promise<Array<any>> => {\n        const { i18n, getLastUsedPath, setLastUsedPath } = this.props;\n        const options = {\n          multiSelections,\n          title: i18n._(t`Choose a video file`),\n          name: i18n._(t`Video files`),\n          extensions: ['mp4'],\n        };\n        return selectLocalResourcePath(\n          i18n,\n          project,\n          options,\n          getLastUsedPath,\n          setLastUsedPath,\n          'video'\n        ).then(resources => {\n          return resources.map(resourcePath => {\n            const videoResource = new gd.VideoResource();\n            const projectPath = path.dirname(project.getProjectFile());\n            videoResource.setFile(path.relative(projectPath, resourcePath));\n            videoResource.setName(path.relative(projectPath, resourcePath));\n\n            return videoResource;\n          });\n        });\n      };\n\n      render() {\n        return null;\n      }\n    },\n  },\n  {\n    name: 'localJsonFileOpener',\n    displayName: 'Choose a new json file',\n    kind: 'json',\n    component: class LocalJsonFileOpener extends Component<ResourceSourceComponentProps> {\n      chooseResources = (\n        project: gdProject,\n        multiSelections: boolean = true\n      ): Promise<Array<any>> => {\n        const { i18n, getLastUsedPath, setLastUsedPath } = this.props;\n        const options = {\n          multiSelections,\n          title: i18n._(t`Choose a json file`),\n          name: i18n._(t`JSON file`),\n          extensions: ['json'],\n        };\n        return selectLocalResourcePath(\n          i18n,\n          project,\n          options,\n          getLastUsedPath,\n          setLastUsedPath,\n          'json'\n        ).then(resources => {\n          return resources.map(resourcePath => {\n            const jsonResource = new gd.JsonResource();\n            const projectPath = path.dirname(project.getProjectFile());\n            jsonResource.setFile(path.relative(projectPath, resourcePath));\n            jsonResource.setName(path.relative(projectPath, resourcePath));\n\n            return jsonResource;\n          });\n        });\n      };\n\n      render() {\n        return null;\n      }\n    },\n  },\n];\n\nconst selectLocalResourcePath = (\n  i18n: I18nType,\n  project: gdProject,\n  options: {\n    multiSelections: boolean,\n    title: string,\n    name: string,\n    extensions: Array<string>,\n  },\n  getLastUsedPath: (project: gdProject, kind: ResourceKind) => string,\n  setLastUsedPath: (\n    project: gdProject,\n    kind: ResourceKind,\n    path: string\n  ) => void,\n  kind: ResourceKind\n): Promise<Array<string>> => {\n  if (!dialog) return Promise.reject('Not supported');\n\n  const properties = ['openFile'];\n  if (options.multiSelections) properties.push('multiSelections');\n  const projectPath = path.dirname(project.getProjectFile());\n\n  const latestPath = getLastUsedPath(project, kind) || projectPath;\n\n  const browserWindow = electron.remote.getCurrentWindow();\n\n  return dialog\n    .showOpenDialog(browserWindow, {\n      title: options.title,\n      properties,\n      filters: [{ name: options.name, extensions: options.extensions }],\n      defaultPath: latestPath,\n    })\n    .then(({ filePaths }) => {\n      if (!filePaths || !filePaths.length) return [];\n\n      const lastUsedPath = path.parse(filePaths[0]).dir;\n      setLastUsedPath(project, kind, lastUsedPath);\n\n      const outsideProjectFolderPaths = filePaths.filter(\n        path => !isPathInProjectFolder(project, path)\n      );\n\n      if (outsideProjectFolderPaths.length) {\n        // eslint-disable-next-line\n        const answer = confirm(\n          i18n._(\n            t`This/these file(s) are outside the project folder. Would you like to make a copy of them in your project folder first (recommended)?`\n          )\n        );\n\n        if (answer) {\n          return copyAllToProjectFolder(project, filePaths);\n        }\n      }\n\n      return filePaths;\n    });\n};\n","// @flow\nimport { openPiskel } from './LocalPiskelBridge';\nimport { openJfxr } from './LocalJfxrBridge';\nimport { openYarn } from './LocalYarnBridge';\nimport { type ResourceExternalEditor } from './ResourceExternalEditor.flow';\nimport { sendExternalEditorOpened } from '../Utils/Analytics/EventSender';\n\n/**\n * This is the list of editors that can be used to edit resources\n * on Electron runtime.\n */\nconst editors: Array<ResourceExternalEditor> = [\n  {\n    name: 'piskel-app',\n    displayName: 'Edit with Piskel',\n    kind: 'image',\n    edit: options => {\n      sendExternalEditorOpened('piskel');\n      return openPiskel(options);\n    },\n  },\n  {\n    name: 'Jfxr',\n    displayName: 'Create/Edit a Sound effect with Jfxr (*.wav)',\n    kind: 'audio',\n    edit: options => {\n      sendExternalEditorOpened('jfxr');\n      return openJfxr(options);\n    },\n  },\n  {\n    name: 'Yarn',\n    displayName: 'Create/Edit a Dialogue Tree with Yarn (*.json)',\n    kind: 'json',\n    edit: options => {\n      sendExternalEditorOpened('yarn');\n      return openYarn(options);\n    },\n  },\n];\n\nexport default editors;\n","// @flow\nimport optionalRequire from '../Utils/OptionalRequire.js';\nimport { type ExternalEditorOpenOptions } from './ResourceExternalEditor.flow';\nimport {\n  createOrUpdateResource,\n  getLocalResourceFullPath,\n} from './ResourceUtils.js';\nconst electron = optionalRequire('electron');\nconst path = optionalRequire('path');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\nconst gd = global.gd;\n\n/**\n * Open Piskel editor for the specified resources.\n * Take a list of resource names to be edited and will call the callback methods\n * (notably onChangesSaved with the name of the edited resources)\n */\nexport const openPiskel = ({\n  project,\n  resourcesLoader,\n  resourceNames,\n  singleFrame,\n  onChangesSaved,\n  extraOptions,\n}: ExternalEditorOpenOptions) => {\n  if (!electron || !ipcRenderer) return;\n\n  const resources = resourceNames.map((resourceName, originalIndex) => {\n    let resourcePath = getLocalResourceFullPath(project, resourceName);\n    return {\n      resourcePath,\n      resourceName,\n      originalIndex,\n    };\n  });\n\n  const projectPath = path.dirname(project.getProjectFile());\n  const externalEditorData = {\n    ...extraOptions,\n    resources,\n    singleFrame,\n    projectPath,\n  };\n\n  // Listen to events meaning that edition in Piskel is finished\n  ipcRenderer.removeAllListeners('piskel-changes-saved');\n  ipcRenderer.on(\n    'piskel-changes-saved',\n    (event, outputResources, newAnimationName, externalEditorData) => {\n      const metadata = externalEditorData.data\n        ? { pskl: externalEditorData }\n        : null;\n\n      const resourcesManager = project.getResourcesManager();\n      outputResources.forEach(resource => {\n        resource.name = path.relative(projectPath, resource.path); // Still needed for onChangesSaved()\n        createOrUpdateResource(project, new gd.ImageResource(), resource.name);\n      });\n\n      outputResources[0].metadata = metadata;\n      outputResources[0].newAnimationName = newAnimationName;\n      // in case this is for a single frame object, save the metadata in the Image object\n      if (externalEditorData.singleFrame) {\n        if (metadata) {\n          resourcesManager\n            .getResource(path.relative(projectPath, outputResources[0].path))\n            .setMetadata(JSON.stringify(metadata));\n        }\n        onChangesSaved(outputResources);\n      } else {\n        // In case there are multiple frames, pass back the metadata to the editor and let it store it at an appropriate place.\n        // (For example, for sprites, SpritesList.js will save it in the metadata of the gd.Direction).\n\n        onChangesSaved(outputResources);\n      }\n    }\n  );\n\n  // Issue the event to open piskel\n  ipcRenderer.send('piskel-open-then-load-animation', externalEditorData);\n};\n","// @flow\nimport optionalRequire from '../Utils/OptionalRequire.js';\nimport { type ExternalEditorOpenOptions } from './ResourceExternalEditor.flow';\nimport {\n  createOrUpdateResource,\n  getLocalResourceFullPath,\n} from './ResourceUtils.js';\n\nconst electron = optionalRequire('electron');\nconst path = optionalRequire('path');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\nconst gd = global.gd;\n\n/**\n * Open JFXR to create wav resources.\n */\nexport const openJfxr = ({\n  project,\n  resourcesLoader,\n  resourceNames,\n  onChangesSaved,\n  extraOptions,\n}: ExternalEditorOpenOptions) => {\n  if (!electron || !ipcRenderer) return;\n  const projectPath = path.dirname(project.getProjectFile());\n  const initialResourcePath = getLocalResourceFullPath(\n    project,\n    resourceNames[0]\n  );\n\n  const externalEditorData = {\n    resourcePath: initialResourcePath,\n    externalEditorData: extraOptions.externalEditorData,\n    projectPath,\n  };\n\n  ipcRenderer.removeAllListeners('jfxr-changes-saved');\n  ipcRenderer.on(\n    'jfxr-changes-saved',\n    (event, newFilePath, externalEditorData) => {\n      const name = path.relative(projectPath, newFilePath);\n      createOrUpdateResource(project, new gd.AudioResource(), name);\n\n      const metadata = {\n        jfxr: externalEditorData,\n      };\n      project\n        .getResourcesManager()\n        .getResource(name)\n        .setMetadata(JSON.stringify(metadata));\n      onChangesSaved([{ metadata, name }]);\n    }\n  );\n\n  ipcRenderer.send('jfxr-create-wav', externalEditorData);\n};\n","// @flow\nimport optionalRequire from '../Utils/OptionalRequire.js';\nimport { type ExternalEditorOpenOptions } from './ResourceExternalEditor.flow';\nimport {\n  createOrUpdateResource,\n  getLocalResourceFullPath,\n} from './ResourceUtils.js';\n\nconst electron = optionalRequire('electron');\nconst path = optionalRequire('path');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\nconst gd = global.gd;\n\n/**\n * Open YARN to Create/Edit Json Dialogue Tree resources.\n */\nexport const openYarn = ({\n  project,\n  resourcesLoader,\n  resourceNames,\n  onChangesSaved,\n  extraOptions,\n}: ExternalEditorOpenOptions) => {\n  if (!electron || !ipcRenderer) return;\n  const projectPath = path.dirname(project.getProjectFile());\n  const initialResourcePath = getLocalResourceFullPath(\n    project,\n    resourceNames[0]\n  );\n\n  const externalEditorData = {\n    resourcePath: initialResourcePath,\n    externalEditorData: extraOptions.externalEditorData,\n    projectPath,\n  };\n\n  ipcRenderer.removeAllListeners('yarn-changes-saved');\n  ipcRenderer.on('yarn-changes-saved', (event, newFilePath) => {\n    const name = path.relative(projectPath, newFilePath);\n    createOrUpdateResource(project, new gd.JsonResource(), name);\n    onChangesSaved([{ name }]);\n  });\n\n  ipcRenderer.send('yarn-create-json', externalEditorData);\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport * as React from 'react';\nimport localFileSystem from '../LocalFileSystem';\nimport optionalRequire from '../../../Utils/OptionalRequire';\nimport { timeFunction } from '../../../Utils/TimeFunction';\nimport { findGDJS } from '../../../GameEngineFinder/LocalGDJSFinder';\nimport LocalNetworkPreviewDialog from './LocalNetworkPreviewDialog';\nimport assignIn from 'lodash/assignIn';\nimport { type PreviewOptions } from '../../PreviewLauncher.flow';\nimport { findLocalIp } from './LocalIpFinder';\nimport SubscriptionChecker from '../../../Profile/SubscriptionChecker';\nconst electron = optionalRequire('electron');\nconst path = optionalRequire('path');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\nconst BrowserWindow = electron ? electron.remote.BrowserWindow : null;\nconst gd = global.gd;\n\ntype Props = {|\n  onExport?: () => void,\n  onChangeSubscription?: () => void,\n|};\n\ntype State = {\n  networkPreviewDialogOpen: boolean,\n  networkPreviewHost: ?string,\n  networkPreviewPort: ?number,\n  networkPreviewError: ?any,\n  previewGamePath: ?string,\n  devToolsOpen: boolean,\n  previewBrowserWindowConfig: ?{\n    width: number,\n    height: number,\n    useContentSize: boolean,\n    title: string,\n    backgroundColor: string,\n  },\n};\n\nexport default class LocalPreviewLauncher extends React.Component<\n  Props,\n  State\n> {\n  canDoNetworkPreview = () => true;\n\n  state = {\n    networkPreviewDialogOpen: false,\n    networkPreviewHost: null,\n    networkPreviewPort: null,\n    networkPreviewError: null,\n    previewGamePath: null,\n    devToolsOpen: false,\n    previewBrowserWindowConfig: null,\n  };\n  _subscriptionChecker: ?SubscriptionChecker = null;\n\n  _openPreviewBrowserWindow = () => {\n    if (\n      !BrowserWindow ||\n      !this.state.previewBrowserWindowConfig ||\n      !this.state.previewGamePath\n    )\n      return;\n\n    const win = new BrowserWindow(this.state.previewBrowserWindowConfig);\n    win.loadURL(`file://${this.state.previewGamePath}/index.html`);\n    win.webContents.on('devtools-opened', () => {\n      this.setState({ devToolsOpen: true });\n    });\n    win.webContents.on('devtools-closed', () => {\n      this.setState({ devToolsOpen: false });\n    });\n    if (this.state.devToolsOpen) win.openDevTools();\n  };\n\n  _openPreviewWindow = (\n    project: gdProject,\n    gamePath: string,\n    options: PreviewOptions\n  ): void => {\n    this.setState(\n      {\n        previewBrowserWindowConfig: {\n          width: project.getGameResolutionWidth(),\n          height: project.getGameResolutionHeight(),\n          useContentSize: true,\n          title: `Preview of ${project.getName()}`,\n          backgroundColor: '#000000',\n        },\n        previewGamePath: gamePath,\n      },\n      () => {\n        if (!options.networkPreview) {\n          this._openPreviewBrowserWindow();\n        } else {\n          if (!ipcRenderer) return;\n\n          ipcRenderer.removeAllListeners('serve-folder-done');\n          ipcRenderer.removeAllListeners('local-network-ips');\n          ipcRenderer.on('serve-folder-done', (event, err, serverParams) => {\n            if (err) {\n              this.setState({\n                networkPreviewDialogOpen: true,\n                networkPreviewPort: null,\n                networkPreviewHost: null,\n                networkPreviewError: err,\n              });\n            } else {\n              this.setState({\n                networkPreviewDialogOpen: true,\n                networkPreviewPort: serverParams.port,\n              });\n            }\n\n            setTimeout(() => this._checkSubscription());\n          });\n          ipcRenderer.on('local-network-ips', (event, ipAddresses) => {\n            this.setState({\n              networkPreviewHost: findLocalIp(ipAddresses),\n            });\n          });\n          ipcRenderer.send('serve-folder', {\n            root: gamePath,\n          });\n          ipcRenderer.send('get-local-network-ips');\n        }\n      }\n    );\n  };\n\n  _prepareExporter = (): Promise<any> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const outputDir = path.join(fileSystem.getTempDir(), 'preview');\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        outputDir,\n        exporter,\n      };\n    });\n  };\n\n  launchLayoutPreview = (\n    project: gdProject,\n    layout: gdLayout,\n    options: PreviewOptions\n  ): Promise<any> => {\n    if (!project || !layout) return Promise.reject();\n\n    return this._prepareExporter().then(({ outputDir, exporter }) => {\n      timeFunction(\n        () => {\n          exporter.exportLayoutForPixiPreview(project, layout, outputDir);\n          exporter.delete();\n          this._openPreviewWindow(project, outputDir, options);\n        },\n        time => console.info(`Preview took ${time}ms`)\n      );\n    });\n  };\n\n  launchExternalLayoutPreview = (\n    project: gdProject,\n    layout: gdLayout,\n    externalLayout: gdExternalLayout,\n    options: PreviewOptions\n  ): Promise<any> => {\n    if (!project || !externalLayout) return Promise.reject();\n\n    return this._prepareExporter().then(({ outputDir, exporter }) => {\n      timeFunction(\n        () => {\n          exporter.exportExternalLayoutForPixiPreview(\n            project,\n            layout,\n            externalLayout,\n            outputDir\n          );\n          exporter.delete();\n          this._openPreviewWindow(project, outputDir, options);\n        },\n        time => console.info(`Preview took ${time}ms`)\n      );\n    });\n  };\n\n  _checkSubscription = () => {\n    if (!this._subscriptionChecker) return true;\n\n    return this._subscriptionChecker.checkHasSubscription();\n  };\n\n  render() {\n    const {\n      networkPreviewDialogOpen,\n      networkPreviewHost,\n      networkPreviewPort,\n      networkPreviewError,\n    } = this.state;\n    return (\n      <React.Fragment>\n        <SubscriptionChecker\n          ref={subscriptionChecker =>\n            (this._subscriptionChecker = subscriptionChecker)\n          }\n          onChangeSubscription={() => {\n            this.setState({ networkPreviewDialogOpen: false });\n            if (this.props.onChangeSubscription)\n              this.props.onChangeSubscription();\n          }}\n          id=\"Preview over wifi\"\n          title={<Trans>Preview over wifi</Trans>}\n          mode=\"try\"\n        />\n        <LocalNetworkPreviewDialog\n          open={networkPreviewDialogOpen}\n          url={\n            networkPreviewHost && networkPreviewPort\n              ? `${networkPreviewHost}:${networkPreviewPort}`\n              : null\n          }\n          error={networkPreviewError}\n          onClose={() => this.setState({ networkPreviewDialogOpen: false })}\n          onExport={this.props.onExport}\n          onRunPreviewLocally={this._openPreviewBrowserWindow}\n        />\n      </React.Fragment>\n    );\n  }\n}\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport * as React from 'react';\nimport Dialog from '../../../UI/Dialog';\nimport FlatButton from '../../../UI/FlatButton';\nimport TextField from '../../../UI/TextField';\nimport Text from '../../../UI/Text';\nimport { Line } from '../../../UI/Grid';\nimport PlaceholderLoader from '../../../UI/PlaceholderLoader';\n\ntype Props = {|\n  open: boolean,\n  url: ?string,\n  onClose: () => void,\n  onExport: ?() => void,\n  onRunPreviewLocally: () => void,\n  error: ?any,\n|};\n\nexport default class LocalNetworkDialog extends React.Component<Props, {}> {\n  render() {\n    const {\n      url,\n      open,\n      error,\n      onExport,\n      onClose,\n      onRunPreviewLocally,\n    } = this.props;\n    if (!open) return null;\n\n    return (\n      <Dialog\n        actions={[\n          <FlatButton\n            key=\"close\"\n            label={<Trans>Close</Trans>}\n            primary\n            onClick={onClose}\n          />,\n        ]}\n        secondaryActions={[\n          onExport && (\n            <FlatButton\n              key=\"export\"\n              label={<Trans>Export game</Trans>}\n              onClick={onExport}\n            />\n          ),\n          <FlatButton\n            key=\"run-preview-locally\"\n            label={<Trans>Run on this computer</Trans>}\n            onClick={onRunPreviewLocally}\n          />,\n        ]}\n        cannotBeDismissed={true}\n        open={open}\n        onRequestClose={onClose}\n      >\n        {error && (\n          <Line>\n            <Text>\n              <Trans>\n                Unable to start the server for the preview! Make sure that you\n                are authorized to run servers on this computer. Otherwise, use\n                classic preview to test your game.\n              </Trans>\n            </Text>\n          </Line>\n        )}\n        {!error && !url && <PlaceholderLoader />}\n        {!error && url && (\n          <div>\n            <Line>\n              <Text>\n                <Trans>\n                  Your preview is ready! On your mobile or tablet, open your\n                  browser and enter in the address bar:\n                </Trans>\n              </Text>\n            </Line>\n            <TextField value={url} fullWidth />\n            <Line>\n              <Text>\n                <Trans>\n                  Please note that your device should be connected on the same\n                  network as this computer.\n                </Trans>\n              </Text>\n            </Line>\n          </div>\n        )}\n      </Dialog>\n    );\n  }\n}\n","// @flow\n\nexport const findLocalIp = (ipAddresses: Array<string>): ?string => {\n  if (!ipAddresses.length) return null;\n\n  let firstLocalIp = ipAddresses.find(\n    ipAddress => ipAddress.indexOf('192.168') === 0\n  );\n  if (firstLocalIp) return firstLocalIp;\n\n  firstLocalIp = ipAddresses.find(ipAddress => ipAddress.indexOf('192') === 0);\n  if (firstLocalIp) return firstLocalIp;\n\n  return ipAddresses[0];\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport * as React from 'react';\nimport { type Exporter } from '../ExportDialog';\nimport { localCordovaExportPipeline } from './LocalCordovaExport';\nimport { localElectronExportPipeline } from './LocalElectronExport';\nimport { localHTML5ExportPipeline } from './LocalHTML5Export';\nimport { localCocos2dExportPipeline } from './LocalCocos2dExport';\nimport { localFacebookInstantGamesExportPipeline } from './LocalFacebookInstantGamesExport';\nimport { localOnlineCordovaExportPipeline } from './LocalOnlineCordovaExport.js';\nimport { localOnlineElectronExportPipeline } from './LocalOnlineElectronExport.js';\nimport { localOnlineWebExportPipeline } from './LocalOnlineWebExport';\nimport PhoneIphone from '@material-ui/icons/PhoneIphone';\nimport LaptopMac from '@material-ui/icons/LaptopMac';\nimport Folder from '@material-ui/icons/Folder';\nimport Facebook from '../../UI/CustomSvgIcons/Facebook';\nimport Cordova from '../../UI/CustomSvgIcons/Cordova';\nimport Chrome from '../../UI/CustomSvgIcons/Chrome';\n\nexport const getLocalExporters = (): Array<Exporter> => [\n  {\n    name: <Trans>Android (&amp; iOS coming soon)</Trans>,\n    renderIcon: props => <PhoneIphone {...props} />,\n    helpPage: '/publishing/android_and_ios',\n    description: (\n      <Trans>\n        Package your game for Android directly from GDevelop. iOS support is\n        coming soon!\n      </Trans>\n    ),\n    key: 'localonlinecordovaexport',\n    exportPipeline: localOnlineCordovaExportPipeline,\n  },\n  {\n    name: <Trans>Web (upload online)</Trans>,\n    renderIcon: props => <Chrome {...props} />,\n    helpPage: '/publishing/web',\n    description: (\n      <Trans>\n        Upload your game online directly from GDevelop and share the link to\n        players. Play to your game using your browser on computers and mobile\n        phones.\n      </Trans>\n    ),\n    key: 'localonlinewebexport',\n    exportPipeline: localOnlineWebExportPipeline,\n  },\n  {\n    name: <Trans>Local folder</Trans>,\n    renderIcon: props => <Folder {...props} />,\n    helpPage: '/publishing/html5_game_in_a_local_folder',\n    description: (\n      <Trans>\n        Build the game locally as a HTML5 game. You can then publish it on\n        website like Kongregate, Game Jolt, itch.io, Poki...\n      </Trans>\n    ),\n    key: 'localexport',\n    exportPipeline: localHTML5ExportPipeline,\n    advanced: true,\n  },\n  {\n    name: <Trans>Facebook Instant Games</Trans>,\n    renderIcon: props => <Facebook {...props} />,\n    helpPage: '/publishing/publishing-to-facebook-instant-games',\n    description: (\n      <Trans>\n        Package your game as a Facebook Instant Games that can be played on\n        Facebook Messenger.\n      </Trans>\n    ),\n    key: 'localfacebookinstantgames',\n    exportPipeline: localFacebookInstantGamesExportPipeline,\n    advanced: true,\n  },\n  {\n    name: <Trans>iOS &amp; Android (manual)</Trans>,\n    renderIcon: props => <Cordova {...props} />,\n    helpPage: '/publishing/android_and_ios_with_cordova',\n    description: (\n      <Trans>\n        Build the game locally as a Cordova project, and export it manually to\n        iOS or Android with Cordova developers tools.\n      </Trans>\n    ),\n    key: 'localcordovaexport',\n    exportPipeline: localCordovaExportPipeline,\n    advanced: true,\n  },\n  {\n    name: <Trans>Windows/macOS/Linux</Trans>,\n    renderIcon: props => <LaptopMac {...props} />,\n    helpPage: '/publishing/windows-macos-linux',\n    description: (\n      <Trans>\n        Package your game as an app for Windows, macOS or Linux directly from\n        GDevelop.\n      </Trans>\n    ),\n    key: 'localonlineelectronexport',\n    exportPipeline: localOnlineElectronExportPipeline,\n  },\n  {\n    name: <Trans>Windows/macOS/Linux (manual)</Trans>,\n    renderIcon: props => <LaptopMac {...props} />,\n    helpPage: '/publishing/windows-macos-linux-with-electron',\n    description: (\n      <Trans>\n        Build the game locally and export it manually to Windows, macOS or Linux\n        with third-party developer tools.\n      </Trans>\n    ),\n    key: 'localelectronexport',\n    exportPipeline: localElectronExportPipeline,\n    advanced: true,\n  },\n  {\n    name: <Trans>Cocos2d-JS</Trans>,\n    renderIcon: props => <PhoneIphone {...props} />,\n    helpPage: '/publishing/android_and_ios_with_cocos2d-js',\n    description: (\n      <Trans>\n        Export your game using Cocos2d-JS game engine. The game can be compiled\n        for Android or iOS if you install Cocos2d-JS developer tools.\n      </Trans>\n    ),\n    key: 'localcocos2dexport',\n    exportPipeline: localCocos2dExportPipeline,\n    experimental: true,\n  },\n];\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport React from 'react';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Column, Line } from '../../UI/Grid';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport localFileSystem from './LocalFileSystem';\nimport LocalFolderPicker from '../../UI/LocalFolderPicker';\nimport assignIn from 'lodash/assignIn';\nimport optionalRequire from '../../Utils/OptionalRequire';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n} from '../GenericExporters/CordovaExport';\nconst electron = optionalRequire('electron');\nconst shell = electron ? electron.shell : null;\n\nconst gd = global.gd;\n\ntype ExportState = {\n  outputDir: string,\n};\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n|};\n\ntype ExportOutput = null;\n\ntype ResourcesDownloadOutput = null;\n\ntype CompressionOutput = null;\n\nexport const localCordovaExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-cordova',\n\n  getInitialExportState: (project: gdProject) => ({\n    outputDir: project.getLastCompilationDirectory(),\n  }),\n\n  canLaunchBuild: exportState => !!exportState.outputDir,\n\n  renderHeader: ({ project, exportState, updateExportState }) => (\n    <Column noMargin>\n      <Line>\n        <Column noMargin>\n          <ExplanationHeader />\n        </Column>\n      </Line>\n      <Line>\n        <LocalFolderPicker\n          type=\"export\"\n          value={exportState.outputDir}\n          defaultPath={project.getLastCompilationDirectory()}\n          onChange={outputDir => {\n            updateExportState(() => ({ outputDir }));\n          }}\n          fullWidth\n        />\n      </Line>\n    </Column>\n  ),\n\n  renderLaunchButtonLabel: () => <Trans>Package</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exportOptions.set('exportForCordova', true);\n    exporter.exportWholePixiProject(\n      context.project,\n      context.exportState.outputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve(null);\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve(null);\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    return Promise.resolve(null);\n  },\n\n  renderDoneFooter: ({ exportState, onClose }) => {\n    const openExportFolder = () => {\n      if (shell) shell.openItem(exportState.outputDir);\n    };\n\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <RaisedButton\n            key=\"open\"\n            label={<Trans>Open folder</Trans>}\n            primary={true}\n            onClick={openExportFolder}\n          />\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport React from 'react';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Column, Line } from '../../UI/Grid';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport localFileSystem from './LocalFileSystem';\nimport LocalFolderPicker from '../../UI/LocalFolderPicker';\nimport assignIn from 'lodash/assignIn';\nimport optionalRequire from '../../Utils/OptionalRequire';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n} from '../GenericExporters/ElectronExport';\nconst electron = optionalRequire('electron');\nconst shell = electron ? electron.shell : null;\n\nconst gd = global.gd;\n\ntype ExportState = {\n  outputDir: string,\n};\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n|};\n\ntype ExportOutput = null;\n\ntype ResourcesDownloadOutput = null;\n\ntype CompressionOutput = null;\n\nexport const localElectronExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-electron',\n\n  getInitialExportState: (project: gdProject) => ({\n    outputDir: project.getLastCompilationDirectory(),\n  }),\n\n  canLaunchBuild: exportState => !!exportState.outputDir,\n\n  renderHeader: ({ project, exportState, updateExportState }) => (\n    <Column noMargin>\n      <Line>\n        <Column noMargin>\n          <ExplanationHeader />\n        </Column>\n      </Line>\n      <Line>\n        <LocalFolderPicker\n          type=\"export\"\n          value={exportState.outputDir}\n          defaultPath={project.getLastCompilationDirectory()}\n          onChange={outputDir => {\n            updateExportState(() => ({ outputDir }));\n          }}\n          fullWidth\n        />\n      </Line>\n    </Column>\n  ),\n\n  renderLaunchButtonLabel: () => <Trans>Package</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exportOptions.set('exportForElectron', true);\n    exporter.exportWholePixiProject(\n      context.project,\n      context.exportState.outputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve(null);\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve(null);\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    return Promise.resolve(null);\n  },\n\n  renderDoneFooter: ({ exportState, onClose }) => {\n    const openExportFolder = () => {\n      if (shell) shell.openItem(exportState.outputDir);\n    };\n\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <RaisedButton\n            key=\"open\"\n            label={<Trans>Open folder</Trans>}\n            primary={true}\n            onClick={openExportFolder}\n          />\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport React from 'react';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Column, Line } from '../../UI/Grid';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport localFileSystem from './LocalFileSystem';\nimport LocalFolderPicker from '../../UI/LocalFolderPicker';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport optionalRequire from '../../Utils/OptionalRequire';\nimport { ExplanationHeader, DoneFooter } from '../GenericExporters/HTML5Export';\nconst electron = optionalRequire('electron');\nconst shell = electron ? electron.shell : null;\n\nconst gd = global.gd;\n\ntype ExportState = {\n  outputDir: string,\n};\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n|};\n\ntype ExportOutput = null;\n\ntype ResourcesDownloadOutput = null;\n\ntype CompressionOutput = null;\n\nexport const localHTML5ExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-html5',\n\n  getInitialExportState: (project: gdProject) => ({\n    outputDir: project.getLastCompilationDirectory(),\n  }),\n\n  canLaunchBuild: exportState => !!exportState.outputDir,\n\n  renderHeader: ({ project, exportState, updateExportState }) => (\n    <Column noMargin>\n      <Line>\n        <ExplanationHeader />\n      </Line>\n      <Line>\n        <LocalFolderPicker\n          type=\"export\"\n          value={exportState.outputDir}\n          defaultPath={project.getLastCompilationDirectory()}\n          onChange={outputDir => {\n            updateExportState(() => ({ outputDir }));\n          }}\n          fullWidth\n        />\n      </Line>\n    </Column>\n  ),\n\n  renderLaunchButtonLabel: () => <Trans>Export as a HTML5 game</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exporter.exportWholePixiProject(\n      context.project,\n      context.exportState.outputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve(null);\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve(null);\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    return Promise.resolve(null);\n  },\n\n  renderDoneFooter: ({ exportState, onClose }) => {\n    const openExportFolder = () => {\n      if (shell) shell.openItem(exportState.outputDir);\n    };\n\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <RaisedButton\n            fullWidth\n            primary\n            onClick={() => openExportFolder()}\n            label={<Trans>Open the exported game folder</Trans>}\n          />\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport React from 'react';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Column, Line } from '../../UI/Grid';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport localFileSystem from './LocalFileSystem';\nimport LocalFolderPicker from '../../UI/LocalFolderPicker';\nimport assignIn from 'lodash/assignIn';\nimport optionalRequire from '../../Utils/OptionalRequire';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport Toggle from '../../UI/Toggle';\nimport {\n  DoneFooter,\n  ExplanationHeader,\n} from '../GenericExporters/Cocos2dExport';\nconst electron = optionalRequire('electron');\nconst shell = electron ? electron.shell : null;\n\nconst gd = global.gd;\n\ntype ExportState = {\n  outputDir: string,\n  debugMode: boolean,\n};\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n|};\n\ntype ExportOutput = null;\n\ntype ResourcesDownloadOutput = null;\n\ntype CompressionOutput = null;\n\nexport const localCocos2dExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-cocos2d',\n\n  getInitialExportState: (project: gdProject) => ({\n    outputDir: project.getLastCompilationDirectory(),\n    debugMode: false,\n  }),\n\n  canLaunchBuild: exportState => !!exportState.outputDir,\n\n  renderHeader: ({ project, exportState, updateExportState }) => (\n    <Column noMargin>\n      <Line>\n        <ExplanationHeader />\n      </Line>\n      <Line>\n        <LocalFolderPicker\n          type=\"export\"\n          value={exportState.outputDir}\n          defaultPath={project.getLastCompilationDirectory()}\n          onChange={outputDir => {\n            updateExportState(prevState => ({ ...prevState, outputDir }));\n          }}\n          fullWidth\n        />\n      </Line>\n      <Line>\n        <Toggle\n          onToggle={(e, check) =>\n            updateExportState(prevState => ({\n              ...prevState,\n              debugMode: check,\n            }))\n          }\n          toggled={exportState.debugMode}\n          labelPosition=\"right\"\n          label={\n            <Trans>\n              Debug mode (show FPS counter and stats in the bottom left)\n            </Trans>\n          }\n        />\n      </Line>\n    </Column>\n  ),\n\n  renderLaunchButtonLabel: () => <Trans>Package</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    exporter.exportWholeCocos2dProject(\n      context.project,\n      context.exportState.debugMode,\n      context.exportState.outputDir\n    );\n    exporter.delete();\n\n    return Promise.resolve(null);\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve(null);\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    exportOutput: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    return Promise.resolve(null);\n  },\n\n  renderDoneFooter: ({ exportState, onClose }) => {\n    const openExportFolder = () => {\n      if (shell) shell.openItem(exportState.outputDir);\n    };\n\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <RaisedButton\n            key=\"open\"\n            label={<Trans>Open folder</Trans>}\n            primary={true}\n            onClick={openExportFolder}\n          />\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\n\nimport React from 'react';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Column, Line } from '../../UI/Grid';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport localFileSystem from './LocalFileSystem';\nimport assignIn from 'lodash/assignIn';\nimport optionalRequire from '../../Utils/OptionalRequire';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport LocalFilePicker from '../../UI/LocalFilePicker';\nimport { archiveLocalFolder } from '../../Utils/LocalArchiver';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n} from '../GenericExporters/FacebookInstantGamesExport';\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst app = electron ? electron.remote.app : null;\nconst shell = electron ? electron.shell : null;\n\nconst gd = global.gd;\n\ntype ExportState = {\n  archiveOutputFilename: string,\n};\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  temporaryOutputDir: string,\n|};\n\ntype ExportOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype ResourcesDownloadOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype CompressionOutput = string;\n\nexport const localFacebookInstantGamesExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-facebook-instant-games',\n\n  getInitialExportState: (project: gdProject) => ({\n    archiveOutputFilename: app\n      ? path.join(app.getPath('documents'), 'fb-instant-game.zip')\n      : '',\n  }),\n\n  canLaunchBuild: exportState => !!exportState.archiveOutputFilename,\n\n  renderHeader: ({ project, exportState, updateExportState }) => (\n    <Column noMargin>\n      <Line>\n        <ExplanationHeader />\n      </Line>\n      <Line>\n        <LocalFilePicker\n          title={'Facebook Instant Games export zip file'}\n          message={\n            'Choose where to save the exported file for Facebook Instant Games'\n          }\n          filters={[\n            {\n              name: 'Compressed file for Facebook Instant Games',\n              extensions: ['zip'],\n            },\n          ]}\n          value={exportState.archiveOutputFilename}\n          defaultPath={app ? app.getPath('documents') : ''}\n          onChange={value =>\n            updateExportState(() => ({ archiveOutputFilename: value }))\n          }\n          fullWidth\n        />\n      </Line>\n    </Column>\n  ),\n\n  renderLaunchButtonLabel: () => <Trans>Package</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n      const temporaryOutputDir = path.join(\n        fileSystem.getTempDir(),\n        'FacebookInstantGamesExport'\n      );\n      fileSystem.mkDir(temporaryOutputDir);\n      fileSystem.clearDir(temporaryOutputDir);\n\n      return {\n        exporter,\n        temporaryOutputDir,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, temporaryOutputDir }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exportOptions.set('exportForFacebookInstantGames', true);\n    exporter.exportWholePixiProject(\n      context.project,\n      temporaryOutputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    return archiveLocalFolder({\n      path: temporaryOutputDir,\n      outputFilename: context.exportState.archiveOutputFilename,\n    });\n  },\n\n  renderDoneFooter: ({ exportState, onClose }) => {\n    const openExportFolder = () => {\n      if (shell && path)\n        shell.openItem(path.dirname(exportState.archiveOutputFilename));\n    };\n\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <RaisedButton\n            key=\"open\"\n            label={<Trans>Open folder</Trans>}\n            primary={true}\n            onClick={openExportFolder}\n          />\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport { t } from '@lingui/macro';\n\nimport React, { PureComponent } from 'react';\nimport TextField from '../TextField';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport RaisedButton from '../RaisedButton';\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst styles = {\n  container: {\n    position: 'relative',\n    display: 'flex',\n    alignItems: 'baseline',\n  },\n  button: {\n    marginLeft: 10,\n  },\n  textField: {\n    flex: 1,\n  },\n};\n\ntype Props = {|\n  value: string,\n  onChange: string => void,\n  title: string,\n  message: string,\n  defaultPath?: string,\n  fullWidth?: boolean,\n  filters: Array<{\n    name: string,\n    extensions: Array<string>,\n  }>,\n|};\n\nexport default class LocalFilePicker extends PureComponent<Props, *> {\n  onChooseFolder = () => {\n    if (!dialog || !electron) return;\n\n    const browserWindow = electron.remote.getCurrentWindow();\n    return dialog\n      .showSaveDialog(browserWindow, {\n        title: this.props.title,\n        filters: this.props.filters,\n        message: this.props.message,\n        defaultPath: this.props.defaultPath,\n      })\n      .then(({ filePath }) => {\n        this.props.onChange(filePath || '');\n      });\n  };\n\n  render() {\n    return (\n      <div\n        style={{\n          ...styles.container,\n          width: this.props.fullWidth ? '100%' : undefined,\n        }}\n      >\n        <TextField\n          margin=\"dense\"\n          style={styles.textField}\n          type=\"text\"\n          hintText={t`Choose a file`}\n          value={this.props.value}\n          onChange={(event, value) => this.props.onChange(value)}\n        />\n        <RaisedButton\n          label={<Trans>Choose</Trans>}\n          style={styles.button}\n          onClick={this.onChooseFolder}\n        />\n      </div>\n    );\n  }\n}\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildCordovaAndroid,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadLocalFile } from './LocalFileUploader';\nimport { type UserProfile } from '../../Profile/UserProfileContext';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport { archiveLocalFolder } from '../../Utils/LocalArchiver';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport localFileSystem from './LocalFileSystem';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport { ExplanationHeader } from '../GenericExporters/OnlineCordovaExport';\nconst path = optionalRequire('path');\nconst os = optionalRequire('os');\nconst gd = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  temporaryOutputDir: string,\n|};\n\ntype ExportOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype ResourcesDownloadOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype CompressionOutput = string;\n\nexport const localOnlineCordovaExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-online-cordova',\n  onlineBuildType: 'cordova-build',\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderLaunchButtonLabel: () => <Trans>Packaging for Android</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n      const temporaryOutputDir = path.join(\n        fileSystem.getTempDir(),\n        'OnlineCordovaExport'\n      );\n      fileSystem.mkDir(temporaryOutputDir);\n      fileSystem.clearDir(temporaryOutputDir);\n\n      return {\n        exporter,\n        temporaryOutputDir,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, temporaryOutputDir }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exportOptions.set('exportForCordova', true);\n    exporter.exportWholePixiProject(\n      context.project,\n      temporaryOutputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    const archiveOutputDir = os.tmpdir();\n    return archiveLocalFolder({\n      path: temporaryOutputDir,\n      outputFilename: path.join(archiveOutputDir, 'game-archive.zip'),\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    outputFile: CompressionOutput\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadLocalFile(\n        outputFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    userProfile: UserProfile,\n    uploadBucketKey: string\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, profile } = userProfile;\n    if (!profile) return Promise.reject(new Error('User is not authenticated'));\n\n    return buildCordovaAndroid(\n      getAuthorizationHeader,\n      profile.uid,\n      uploadBucketKey\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildElectron,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { type UserProfile } from '../../Profile/UserProfileContext';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport { uploadLocalFile } from './LocalFileUploader';\nimport { archiveLocalFolder } from '../../Utils/LocalArchiver';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport localFileSystem from './LocalFileSystem';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  type ExportState,\n  SetupExportHeader,\n} from '../GenericExporters/OnlineElectronExport';\nconst path = optionalRequire('path');\nconst os = optionalRequire('os');\nconst gd = global.gd;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  temporaryOutputDir: string,\n|};\n\ntype ExportOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype ResourcesDownloadOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype CompressionOutput = string;\n\nexport const localOnlineElectronExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-online-electron',\n  onlineBuildType: 'electron-build',\n\n  getInitialExportState: () => ({\n    targets: ['winExe'],\n  }),\n\n  canLaunchBuild: (exportState: ExportState) => !!exportState.targets.length,\n\n  renderHeader: props => <SetupExportHeader {...props} />,\n\n  renderLaunchButtonLabel: () => <Trans>Package</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n      const temporaryOutputDir = path.join(\n        fileSystem.getTempDir(),\n        'OnlineElectronExport'\n      );\n      fileSystem.mkDir(temporaryOutputDir);\n      fileSystem.clearDir(temporaryOutputDir);\n\n      return {\n        exporter,\n        temporaryOutputDir,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, temporaryOutputDir }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exportOptions.set('exportForElectron', true);\n    exporter.exportWholePixiProject(\n      context.project,\n      temporaryOutputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    const archiveOutputDir = os.tmpdir();\n    return archiveLocalFolder({\n      path: temporaryOutputDir,\n      outputFilename: path.join(archiveOutputDir, 'game-archive.zip'),\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    outputFile: CompressionOutput\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadLocalFile(\n        outputFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    userProfile: UserProfile,\n    uploadBucketKey: string\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, profile } = userProfile;\n    if (!profile) return Promise.reject(new Error('User is not authenticated'));\n\n    return buildElectron(\n      getAuthorizationHeader,\n      profile.uid,\n      uploadBucketKey,\n      exportState.targets\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildWeb,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadLocalFile } from './LocalFileUploader';\nimport { type UserProfile } from '../../Profile/UserProfileContext';\nimport { findGDJS } from '../../GameEngineFinder/LocalGDJSFinder';\nimport { archiveLocalFolder } from '../../Utils/LocalArchiver';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport localFileSystem from './LocalFileSystem';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport { ExplanationHeader } from '../GenericExporters/OnlineWebExport';\nconst path = optionalRequire('path');\nconst os = optionalRequire('os');\nconst gd = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  temporaryOutputDir: string,\n|};\n\ntype ExportOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype ResourcesDownloadOutput = {|\n  temporaryOutputDir: string,\n|};\n\ntype CompressionOutput = string;\n\nexport const localOnlineWebExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: 'local-online-web',\n  onlineBuildType: 'web-build',\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderLaunchButtonLabel: () => <Trans>Publish online</Trans>,\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS().then(({ gdjsRoot }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        localFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n      const temporaryOutputDir = path.join(\n        fileSystem.getTempDir(),\n        'OnlineWebExport'\n      );\n      fileSystem.mkDir(temporaryOutputDir);\n      fileSystem.clearDir(temporaryOutputDir);\n\n      return {\n        exporter,\n        temporaryOutputDir,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, temporaryOutputDir }: PreparedExporter\n  ): Promise<ExportOutput> => {\n    const exportOptions = new gd.MapStringBoolean();\n    exporter.exportWholePixiProject(\n      context.project,\n      temporaryOutputDir,\n      exportOptions\n    );\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return Promise.resolve({ temporaryOutputDir });\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { temporaryOutputDir }: ResourcesDownloadOutput\n  ): Promise<CompressionOutput> => {\n    const archiveOutputDir = os.tmpdir();\n    return archiveLocalFolder({\n      path: temporaryOutputDir,\n      outputFilename: path.join(archiveOutputDir, 'game-archive.zip'),\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    outputFile: CompressionOutput\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadLocalFile(\n        outputFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    userProfile: UserProfile,\n    uploadBucketKey: string\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, profile } = userProfile;\n    if (!profile) return Promise.reject(new Error('User is not authenticated'));\n\n    return buildWeb(getAuthorizationHeader, profile.uid, uploadBucketKey);\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport optionalRequire from '../Utils/OptionalRequire';\nimport { t } from '@lingui/macro';\nimport { isMacLike } from '../Utils/Platform';\nimport { type MainMenuProps } from './MainMenu.flow';\nconst electron = optionalRequire('electron');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\n\ntype MainMenuEvent =\n  | 'main-menu-open'\n  | 'main-menu-save'\n  | 'main-menu-save-as'\n  | 'main-menu-close'\n  | 'main-menu-close-app'\n  | 'main-menu-export'\n  | 'main-menu-create'\n  | 'main-menu-open-project-manager'\n  | 'main-menu-open-start-page'\n  | 'main-menu-open-debugger'\n  | 'main-menu-open-about'\n  | 'main-menu-open-preferences'\n  | 'main-menu-open-language'\n  | 'main-menu-open-profile'\n  | 'update-status';\n\ntype MenuItemTemplate =\n  | {|\n      onClickSendEvent?: MainMenuEvent,\n      onClickOpenLink?: string,\n      accelerator?: string,\n      enabled?: boolean,\n      label?: string,\n    |}\n  | {|\n      submenu: Array<MenuItemTemplate>,\n      label: string,\n    |}\n  | {|\n      submenu: Array<MenuItemTemplate>,\n      role: string,\n    |}\n  | {|\n      type: 'separator',\n    |}\n  | {|\n      role: string,\n    |};\n\ntype RootMenuTemplate =\n  | {|\n      label: string,\n      submenu: Array<MenuItemTemplate>,\n    |}\n  | {|\n      role: string,\n      submenu: Array<MenuItemTemplate>,\n    |};\n\n/**\n * Forward events received from Electron main process\n * to the underlying child React component.\n */\nclass ElectronMainMenu extends React.Component<MainMenuProps, {||}> {\n  _language: ?string;\n\n  componentDidMount() {\n    if (!ipcRenderer) return;\n\n    ipcRenderer.on(('main-menu-open': MainMenuEvent), event =>\n      this.props.onChooseProject()\n    );\n    ipcRenderer.on(('main-menu-save': MainMenuEvent), event =>\n      this.props.onSaveProject()\n    );\n    ipcRenderer.on(('main-menu-save-as': MainMenuEvent), event =>\n      this.props.onSaveProjectAs()\n    );\n    ipcRenderer.on(('main-menu-close': MainMenuEvent), event =>\n      this.props.onCloseProject()\n    );\n    ipcRenderer.on(('main-menu-close-app': MainMenuEvent), event =>\n      this.props.onCloseApp()\n    );\n    ipcRenderer.on(('main-menu-export': MainMenuEvent), event =>\n      this.props.onExportProject()\n    );\n    ipcRenderer.on(('main-menu-create': MainMenuEvent), event =>\n      this.props.onCreateProject()\n    );\n    ipcRenderer.on(('main-menu-open-project-manager': MainMenuEvent), event =>\n      this.props.onOpenProjectManager()\n    );\n    ipcRenderer.on(('main-menu-open-start-page': MainMenuEvent), event =>\n      this.props.onOpenStartPage()\n    );\n    ipcRenderer.on(('main-menu-open-debugger': MainMenuEvent), event =>\n      this.props.onOpenDebugger()\n    );\n    ipcRenderer.on(('main-menu-open-about': MainMenuEvent), event =>\n      this.props.onOpenAbout()\n    );\n    ipcRenderer.on(('main-menu-open-preferences': MainMenuEvent), event =>\n      this.props.onOpenPreferences()\n    );\n    ipcRenderer.on(('main-menu-open-language': MainMenuEvent), event =>\n      this.props.onOpenLanguage()\n    );\n    ipcRenderer.on(('main-menu-open-profile': MainMenuEvent), event =>\n      this.props.onOpenProfile()\n    );\n    ipcRenderer.on(('update-status': MainMenuEvent), (event, status) =>\n      this.props.setUpdateStatus(status)\n    );\n\n    this._buildAndSendMenuTemplate();\n  }\n\n  componentDidUpdate(prevProps: MainMenuProps) {\n    if (this.props.i18n.language !== this._language) {\n      this._buildAndSendMenuTemplate();\n      this._language = this.props.i18n.language;\n    }\n\n    // Update menu if a project has just been opened or closed\n    if (prevProps.project !== this.props.project) {\n      this._buildAndSendMenuTemplate();\n    }\n  }\n\n  _buildAndSendMenuTemplate() {\n    const { i18n } = this.props;\n    const fileTemplate = {\n      label: i18n._(t`File`),\n      submenu: [\n        {\n          label: i18n._(t`Create a New Project...`),\n          accelerator: 'CommandOrControl+N',\n          onClickSendEvent: 'main-menu-create',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Open...`),\n          accelerator: 'CommandOrControl+O',\n          onClickSendEvent: 'main-menu-open',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Save`),\n          accelerator: 'CommandOrControl+S',\n          onClickSendEvent: 'main-menu-save',\n          enabled: !!this.props.project,\n        },\n        {\n          label: i18n._(t`Save as...`),\n          accelerator: 'CommandOrControl+Alt+S',\n          onClickSendEvent: 'main-menu-save-as',\n          enabled: !!this.props.project,\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Export (web, iOS, Android)...`),\n          accelerator: 'CommandOrControl+E',\n          onClickSendEvent: 'main-menu-export',\n          enabled: !!this.props.project,\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Close Project`),\n          accelerator: 'CommandOrControl+Shift+W',\n          onClickSendEvent: 'main-menu-close',\n          enabled: !!this.props.project,\n        },\n      ],\n    };\n    if (!isMacLike()) {\n      fileTemplate.submenu.push(\n        { type: 'separator' },\n        {\n          label: i18n._(t`My Profile`),\n          onClickSendEvent: 'main-menu-open-profile',\n        },\n        {\n          label: i18n._(t`Preferences`),\n          onClickSendEvent: 'main-menu-open-preferences',\n        },\n        {\n          label: i18n._(t`Language`),\n          onClickSendEvent: 'main-menu-open-language',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Exit GDevelop`),\n          accelerator: 'Control+Q',\n          onClickSendEvent: 'main-menu-close-app',\n        }\n      );\n    }\n\n    const editTemplate = {\n      label: i18n._(t`Edit`),\n      submenu: [\n        { role: 'undo' },\n        { role: 'redo' },\n        { type: 'separator' },\n        { role: 'cut' },\n        { role: 'copy' },\n        { role: 'paste' },\n        { role: 'pasteandmatchstyle' },\n        { role: 'delete' },\n        { role: 'selectall' },\n      ],\n    };\n\n    const viewTemplate = {\n      label: i18n._(t`View`),\n      submenu: [\n        {\n          label: i18n._(t`Show Project Manager`),\n          accelerator: 'CommandOrControl+Alt+P',\n          onClickSendEvent: 'main-menu-open-project-manager',\n          enabled: !!this.props.project,\n        },\n        {\n          label: i18n._(t`Show Start Page`),\n          onClickSendEvent: 'main-menu-open-start-page',\n        },\n        {\n          label: i18n._(t`Open Debugger`),\n          onClickSendEvent: 'main-menu-open-debugger',\n          enabled: !!this.props.project,\n        },\n        { type: 'separator' },\n        { role: 'toggledevtools' },\n        { type: 'separator' },\n        { role: 'togglefullscreen' },\n      ],\n    };\n\n    const windowTemplate = {\n      role: 'window',\n      submenu: [{ role: 'minimize' }],\n    };\n\n    const helpTemplate = {\n      role: 'help',\n      submenu: [\n        {\n          label: i18n._(t`GDevelop website`),\n          onClickOpenLink: 'http://gdevelop-app.com',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Community Forums`),\n          onClickOpenLink: 'https://forum.gdevelop-app.com',\n        },\n        {\n          label: i18n._(t`Community Discord Chat`),\n          onClickOpenLink: 'https://discord.gg/rjdYHvj',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Contribute to GDevelop`),\n          onClickOpenLink: 'https://gdevelop-app.com/contribute/',\n        },\n        {\n          label: i18n._(t`Create Extensions for GDevelop`),\n          onClickOpenLink:\n            'https://github.com/4ian/GDevelop/blob/master/newIDE/README-extensions.md',\n        },\n        { type: 'separator' },\n        {\n          label: i18n._(t`Help to Translate GDevelop`),\n          onClickOpenLink: 'https://crowdin.com/project/gdevelop',\n        },\n        {\n          label: i18n._(t`Report a wrong translation`),\n          onClickOpenLink: 'https://github.com/4ian/GDevelop/issues/969',\n        },\n      ],\n    };\n    if (!isMacLike()) {\n      helpTemplate.submenu.push(\n        { type: 'separator' },\n        {\n          label: i18n._(t`About GDevelop`),\n          onClickSendEvent: 'main-menu-open-about',\n        }\n      );\n    }\n\n    const template: Array<RootMenuTemplate> = [\n      fileTemplate,\n      editTemplate,\n      viewTemplate,\n      windowTemplate,\n      helpTemplate,\n    ];\n\n    if (isMacLike()) {\n      template.unshift({\n        label: i18n._(t`GDevelop 5`),\n        submenu: [\n          {\n            label: i18n._(t`About GDevelop`),\n            onClickSendEvent: 'main-menu-open-about',\n          },\n          { type: 'separator' },\n          {\n            label: i18n._(t`My Profile`),\n            onClickSendEvent: 'main-menu-open-profile',\n          },\n          {\n            label: i18n._(t`Preferences`),\n            onClickSendEvent: 'main-menu-open-preferences',\n          },\n          {\n            label: i18n._(t`Language`),\n            onClickSendEvent: 'main-menu-open-language',\n          },\n          { type: 'separator' },\n          { role: 'services', submenu: [] },\n          { type: 'separator' },\n          { role: 'hide' },\n          { role: 'hideothers' },\n          { role: 'unhide' },\n          { type: 'separator' },\n          { role: 'quit' },\n        ],\n      });\n\n      editTemplate.submenu.push(\n        { type: 'separator' },\n        {\n          label: i18n._(t`Speech`),\n          submenu: [{ role: 'startspeaking' }, { role: 'stopspeaking' }],\n        }\n      );\n\n      windowTemplate.submenu = [\n        { role: 'minimize' },\n        { role: 'zoom' },\n        { type: 'separator' },\n        { role: 'front' },\n      ];\n    }\n\n    if (ipcRenderer) {\n      ipcRenderer.send('set-main-menu', template);\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n\nexport default ElectronMainMenu;\n","// @flow\n// Note: this file does not use export/imports and use Flow comments to allow its usage from Node.js\n\nconst { loadExtension } = require('.');\nconst optionalRequire = require('../Utils/OptionalRequire');\nconst { findJsExtensionModules } = require('./LocalJsExtensionsFinder');\n\n/*flow-include\nimport type {JsExtensionsLoader, TranslationFunction} from '.';\nimport ObjectsEditorService from '../ObjectEditor/ObjectsEditorService';\nimport ObjectsRenderingService from '../ObjectsRendering/ObjectsRenderingService';\n\ntype MakeExtensionsLoaderArguments = {|\n  gd: any,\n  objectsEditorService: typeof ObjectsEditorService,\n  objectsRenderingService: typeof ObjectsRenderingService,\n  filterExamples: boolean,\n|};\n*/\n\n/**\n * Loader that will find all JS extensions declared in GDJS/Runtime/Extensions/xxx/JsExtension.js.\n * If you add a new extension and also want it to be available for the web-app version, add it in\n * BrowserJsExtensionsLoader.js\n */\nmodule.exports = function makeExtensionsLoader(\n  {\n    gd,\n    objectsEditorService,\n    objectsRenderingService,\n    filterExamples,\n  } /*: MakeExtensionsLoaderArguments*/\n) /*: JsExtensionsLoader*/ {\n  return {\n    loadAllExtensions: (_ /*: TranslationFunction */) => {\n      return findJsExtensionModules({ filterExamples }).then(\n        extensionModulePaths => {\n          return Promise.all(\n            extensionModulePaths.map(extensionModulePath => {\n              let extensionModule = null;\n              try {\n                extensionModule = optionalRequire(extensionModulePath, {\n                  rethrowException: true,\n                });\n              } catch (ex) {\n                return {\n                  extensionModulePath,\n                  result: {\n                    message:\n                      'Unable to import extension. Please check for any syntax error or error that would prevent it from being run.',\n                    error: true,\n                    rawError: ex,\n                  },\n                };\n              }\n\n              if (extensionModule) {\n                // Load any editor for objects, if we have somewhere where\n                // to register them.\n                if (\n                  objectsEditorService &&\n                  extensionModule.registerEditorConfigurations\n                ) {\n                  extensionModule.registerEditorConfigurations(\n                    objectsEditorService\n                  );\n                }\n\n                // Load any renderer for objects, if we have somewhere where\n                // to register them.\n                if (\n                  objectsRenderingService &&\n                  extensionModule.registerInstanceRenderers\n                ) {\n                  extensionModule.registerInstanceRenderers(\n                    objectsRenderingService\n                  );\n                }\n\n                return {\n                  extensionModulePath,\n                  result: loadExtension(\n                    _,\n                    gd,\n                    gd.JsPlatform.get(),\n                    extensionModule\n                  ),\n                };\n              }\n\n              return {\n                extensionModulePath,\n                result: {\n                  error: true,\n                  message:\n                    'Unknown error. Please check for any syntax error or error that would prevent it from being run.',\n                },\n              };\n            })\n          );\n        },\n        err => {\n          console.error(`Unable to find JS extensions modules`);\n          throw err;\n        }\n      );\n    },\n  };\n};\n","// Note: this file does not use export/imports nor Flow to allow its usage from Node.js\n\nconst { findGDJS } = require('../GameEngineFinder/LocalGDJSFinder');\nconst optionalRequire = require('../Utils/OptionalRequire');\nconst path = optionalRequire('path');\nconst fs = optionalRequire('fs');\n\nconst checkIfPathHasJsExtensionModule = extensionFolderPath => {\n  return new Promise(resolve => {\n    const jsExtensionModulePath = path.join(\n      extensionFolderPath,\n      'JsExtension.js'\n    );\n    fs.stat(jsExtensionModulePath, (err, stats) => {\n      if (err) {\n        return resolve(null);\n      }\n\n      return resolve(stats.isFile() ? jsExtensionModulePath : null);\n    });\n  });\n};\n\nconst findJsExtensionModules = ({ filterExamples }) => {\n  return findGDJS().then(({ gdjsRoot }) => {\n    const extensionsRoot = path.join(gdjsRoot, 'Runtime', 'Extensions');\n    console.info(\n      `Searching for JS extensions (file called JsExtension.js) in ${extensionsRoot}...`\n    );\n    return new Promise((resolve, reject) => {\n      fs.readdir(extensionsRoot, (error, extensionFolders) => {\n        if (error) {\n          return reject(error);\n        }\n\n        const filteredExtensionFolders = extensionFolders.filter(folder => {\n          if (!filterExamples) return true;\n\n          return folder.indexOf('Example') === -1;\n        });\n\n        Promise.all(\n          filteredExtensionFolders.map(extensionFolder =>\n            checkIfPathHasJsExtensionModule(\n              path.join(extensionsRoot, extensionFolder)\n            )\n          )\n        ).then(modulePaths => {\n          resolve(modulePaths.filter(modulePath => !!modulePath));\n        }, reject);\n      });\n    });\n  });\n};\n\nmodule.exports = {\n  findJsExtensionModules,\n};\n","// @flow\nimport { type EventsFunctionCodeWriter } from '..';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport slugs from 'slugs';\nconst os = optionalRequire('os');\nconst fs = optionalRequire('fs');\n\n/**\n * Create the EventsFunctionCodeWriter that writes generated code for events functions\n * to local files.\n */\nexport const makeLocalEventsFunctionCodeWriter = (): EventsFunctionCodeWriter => {\n  const outputDir = os.tmpdir() + '/GDGeneratedEventsFunctions';\n  fs.mkdir(outputDir, err => {\n    if (err && err.code !== 'EEXIST') {\n      console.error(\n        'Unable to create the directory where to output events functions generated code: ',\n        err\n      );\n      return;\n    }\n  });\n\n  const getPathFor = (codeNamespace: string) => {\n    return `${outputDir}/${slugs(codeNamespace)}.js`;\n  };\n\n  return {\n    getIncludeFileFor: (codeNamespace: string) => getPathFor(codeNamespace),\n    writeFunctionCode: (\n      functionCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      return new Promise((resolve, reject) => {\n        const filepath = getPathFor(functionCodeNamespace);\n        fs.writeFile(filepath, code, err => {\n          if (err) return reject(err);\n\n          resolve();\n        });\n      });\n    },\n    writeBehaviorCode: (\n      behaviorCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      return new Promise((resolve, reject) => {\n        const filepath = getPathFor(behaviorCodeNamespace);\n        fs.writeFile(filepath, code, err => {\n          if (err) return reject(err);\n\n          resolve();\n        });\n      });\n    },\n  };\n};\n","// @flow\nimport { serializeToJSObject } from '../../Utils/Serializer';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nconst fs = optionalRequire('fs-extra');\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst writeJSONFile = (object: Object, filepath: string): Promise<void> => {\n  if (!fs) return Promise.reject(new Error('Filesystem is not supported.'));\n\n  try {\n    const content = JSON.stringify(object, null, 2);\n    return fs.ensureDir(path.dirname(filepath)).then(\n      () =>\n        new Promise((resolve, reject) => {\n          fs.writeFile(filepath, content, (err: ?Error) => {\n            if (err) {\n              return reject(err);\n            }\n\n            return resolve();\n          });\n        })\n    );\n  } catch (stringifyException) {\n    return Promise.reject(stringifyException);\n  }\n};\n\nexport default class LocalEventsFunctionsExtensionWriter {\n  static chooseEventsFunctionExtensionFile = (): Promise<?string> => {\n    if (!dialog) return Promise.reject('Not supported');\n    const browserWindow = electron.remote.getCurrentWindow();\n\n    return dialog\n      .showSaveDialog(browserWindow, {\n        title: 'Export an extension of the project',\n        filters: [\n          {\n            name: 'GDevelop 5 \"events based\" extension',\n            extensions: ['json'],\n          },\n        ],\n        defaultPath: 'Extension.json',\n      })\n      .then(({ filePath }) => {\n        if (!filePath) return null;\n        return filePath;\n      });\n  };\n\n  static writeEventsFunctionsExtension = (\n    extension: gdEventsFunctionsExtension,\n    filepath: string\n  ): Promise<void> => {\n    const serializedObject = serializeToJSObject(extension);\n    return writeJSONFile(serializedObject, filepath).catch(err => {\n      console.error('Unable to write the events function extension:', err);\n      throw err;\n    });\n  };\n}\n","// @flow\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nconst fs = optionalRequire('fs');\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst readJSONFile = (filepath: string): Promise<Object> => {\n  if (!fs) return Promise.reject('Filesystem is not supported.');\n\n  return new Promise((resolve, reject) => {\n    fs.readFile(filepath, { encoding: 'utf8' }, (err, data) => {\n      if (err) return reject(err);\n\n      try {\n        const dataObject = JSON.parse(data);\n        return resolve(dataObject);\n      } catch (ex) {\n        return reject(filepath + ' is a corrupted/malformed file.');\n      }\n    });\n  });\n};\n\nexport default class LocalEventsFunctionsExtensionOpener {\n  static chooseEventsFunctionExtensionFile = (): Promise<?string> => {\n    if (!dialog) return Promise.reject('Not supported');\n    const browserWindow = electron.remote.getCurrentWindow();\n\n    return dialog\n      .showOpenDialog(browserWindow, {\n        title: 'Import an extension in the project',\n        properties: ['openFile'],\n        message: 'Choose an extension file to import (.json file)',\n        filters: [\n          {\n            name: 'GDevelop 5 \"events based\" extension',\n            extensions: ['json'],\n          },\n        ],\n      })\n      .then(({ filePaths }) => {\n        if (!filePaths || !filePaths.length) return null;\n        return filePaths[0];\n      });\n  };\n\n  static readEventsFunctionExtensionFile = (\n    filepath: string\n  ): Promise<Object> => {\n    return readJSONFile(filepath);\n  };\n}\n","// @flow\nimport * as React from 'react';\nimport optionalRequire from '../Utils/OptionalRequire';\nimport PreferencesContext from '../MainFrame/Preferences/PreferencesContext';\nimport debounce from 'lodash/debounce';\nconst electron = optionalRequire('electron');\nconst fs = optionalRequire('fs');\nconst child_process = optionalRequire('child_process');\nconst process = optionalRequire('process');\nconst path = optionalRequire('path');\n\ntype DevelopmentWatchPaths = {\n  paths: Array<string>,\n  pathsWithErrors: { [string]: Error },\n};\n\n/**\n * Returns the folder corresponding to newIDE/app in **development**. Works\n * only when running in Electron.\n */\nconst findDevelopmentNewIdeAppPath = () /*: string */ => {\n  if (!electron) return '';\n\n  const developmentElectronAppFolder = process.cwd();\n  return path.join(developmentElectronAppFolder, '../app');\n};\n\n/**\n * Returns the list of folders to watch containing the **sources** of\n * GDJS and Extensions, found relatively to the current working directory which is the\n * Electron working directory during **development**. Won't work\n * if running on production.\n */\nconst getAllDevelopmentWatchPaths = (): Promise<DevelopmentWatchPaths> => {\n  if (!electron || !fs)\n    return Promise.resolve({ paths: [], pathsWithErrors: {} });\n\n  const pathsWithErrors: { [string]: Error } = {};\n\n  const gdevelopRepositoryRoot = path.join(\n    findDevelopmentNewIdeAppPath(),\n    '../..'\n  );\n  const gdjsSourcesRuntimePath = path.join(\n    gdevelopRepositoryRoot,\n    'GDJS/Runtime'\n  );\n  const gdExtensionsPath = path.join(gdevelopRepositoryRoot, 'Extensions');\n\n  const getExtensionDevelopmentWatchPaths = (): Promise<Array<string>> =>\n    new Promise(resolve =>\n      fs.readdir(gdExtensionsPath, (error: ?Error, files: Array<string>) => {\n        if (error) {\n          pathsWithErrors[gdExtensionsPath] = error;\n          resolve([]);\n          return;\n        }\n\n        resolve(\n          Promise.all(\n            files.map(\n              (file): Promise<?string> =>\n                new Promise(resolve => {\n                  const extensionPath = path.join(gdExtensionsPath, file);\n                  fs.stat(extensionPath, (error, stat) => {\n                    if (error) {\n                      pathsWithErrors[extensionPath] = error;\n                      resolve(extensionPath);\n                      return;\n                    }\n\n                    resolve(stat.isDirectory() ? extensionPath : null);\n                  });\n                })\n            )\n          ).then(paths => paths.filter(Boolean))\n        );\n      })\n    );\n\n  const getGDJSDevelopmentWatchPaths = (): Promise<Array<string>> => {\n    return Promise.resolve(\n      [gdjsSourcesRuntimePath].concat(\n        [\n          // List of all sub folders in GDJS Runtime.\n          // If you add any folder, add it here too so that it\n          // can be watched for changes.\n          'Cocos2d',\n          'Cordova',\n          'Electron',\n          'FacebookInstantGames',\n          'cocos-renderers',\n          'cocos-sound-manager',\n          'events-tools',\n          'fontfaceobserver-font-manager',\n          'howler-sound-manager',\n          'libs',\n          'pixi-renderers',\n          'websocket-debugger-client',\n        ].map(folder => path.join(gdjsSourcesRuntimePath, folder))\n      )\n    );\n  };\n\n  return getExtensionDevelopmentWatchPaths().then(\n    extensionDevelopmentWatchPaths => {\n      return getGDJSDevelopmentWatchPaths().then(gdjsDevelopmentWatchPaths => {\n        return {\n          paths: [\n            ...gdjsDevelopmentWatchPaths,\n            ...extensionDevelopmentWatchPaths,\n          ],\n          pathsWithErrors,\n        };\n      });\n    }\n  );\n};\n\n/**\n * Launch the newIDE script `import-GDJS-Runtime`.\n */\nconst importGDJSRuntime = (): Promise<void> => {\n  if (!child_process || !path) return Promise.reject(new Error('Unsupported'));\n\n  return new Promise((resolve, reject) => {\n    child_process.exec(\n      `node \"${path.join(\n        findDevelopmentNewIdeAppPath(),\n        'scripts/import-GDJS-Runtime.js'\n      )}\"`,\n      (error, stdout, stderr) => {\n        if (error) {\n          console.error(`GDJS Runtime update error: ${error}`);\n          reject(error);\n          return;\n        }\n\n        console.info(`GDJS Runtime update: ${stdout}`);\n\n        if (stderr) {\n          console.error(`GDJS Runtime update error: ${stderr}`);\n          reject(new Error('Error while updating GDJS Runtime'));\n          return;\n        }\n\n        resolve();\n      }\n    );\n  });\n};\n\n/**\n * Callback for fs.watch, so that  whenever a source file is changed,\n * it relaunchs automatically the script to import.\n */\nconst onWatchEvent = debounce((event: ?string, filename: ?string) => {\n  const eventName = event || 'unknown-event';\n  const resolvedFilename = filename || 'unknown-file';\n  console.info(\n    `GDJS/extensions watchers found a \"${eventName}\" in ${resolvedFilename}, updating GDJS Runtime...`\n  );\n  importGDJSRuntime().catch(() => {});\n}, 100 /* Avoid running the script too much in case multiple changes are fired at the same time. */);\n\nconst genericWatcherErrorMessage =\n  'Error in watcher for GDJS Runtime - manually call npm run `node import-GDJS-Runtime.js` in the newIDE/app/scripts folder if you make changes to GDJS.';\n\n/**\n * Set up some watchers for GDJS and Extensions sources.\n * Stop the watchers when the component is unmounted or `shouldWatch` prop is false.\n */\nexport const LocalGDJSDevelopmentWatcher = () => {\n  const preferences = React.useContext(PreferencesContext);\n  const shouldWatch = preferences.values.useGDJSDevelopmentWatcher;\n\n  React.useEffect(\n    () => {\n      if (!shouldWatch) {\n        // Nothing to set up in the effect if watch is deactivated.\n        return;\n      }\n\n      let stopWatchers = false;\n      let watchers = [];\n      let startTime = performance.now();\n      getAllDevelopmentWatchPaths().then(({ paths, pathsWithErrors }) => {\n        // There is a non nul chance that for some reason the effect was cleaned up\n        // before we retrieved all the paths. Stop there if it's the case.\n        if (stopWatchers) return;\n\n        if (!fs) {\n          console.error(\n            \"Unable to use 'fs' from Node.js to watch changes in GDJS.\"\n          );\n          return;\n        }\n\n        // Reload extensions when the component is first mounted\n        importGDJSRuntime().catch(() => {});\n\n        // Create watchers\n        paths.forEach(watchPath => {\n          let watcher = null;\n          try {\n            watcher = fs.watch(watchPath, {}, onWatchEvent);\n          } catch (error) {\n            pathsWithErrors[watchPath] = error;\n            return null;\n          }\n\n          if (watcher) {\n            watcher.on('error', error => {\n              console.warn(genericWatcherErrorMessage, error);\n            });\n\n            watchers.push(watcher);\n          }\n        });\n\n        if (Object.keys(pathsWithErrors).length) {\n          console.warn(\n            'Error while setting up watchers for some paths: ',\n            pathsWithErrors\n          );\n        }\n\n        const totalTimeStr = (performance.now() - startTime).toFixed(2);\n        if (watchers.length) {\n          console.info(\n            `Watchers for GDJS Runtime/extensions installed in ${totalTimeStr}ms.`\n          );\n        } else {\n          console.warn(\n            `No watchers for GDJS Runtime/extensions installed (took ${totalTimeStr}ms).`\n          );\n        }\n      });\n\n      // Close all the watchers when the React effect is unregistered\n      return () => {\n        stopWatchers = true;\n        if (!watchers.length) return;\n\n        watchers.forEach(watcher => {\n          watcher.close();\n        });\n        console.info('Watchers for GDJS Runtime closed.');\n      };\n    },\n    [shouldWatch]\n  );\n\n  return null;\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport { I18n } from '@lingui/react';\nimport { t } from '@lingui/macro';\nimport { type I18n as I18nType } from '@lingui/core';\n\nimport React, { PureComponent } from 'react';\nimport TextField from '../TextField';\nimport RaisedButton from '../RaisedButton';\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst styles = {\n  container: {\n    position: 'relative',\n    display: 'flex',\n    alignItems: 'baseline',\n  },\n  button: {\n    marginLeft: 10,\n  },\n  textField: {\n    flex: 1,\n  },\n};\n\ntype Props = {|\n  type: 'export' | 'create-game',\n  value: string,\n  onChange: string => void,\n  defaultPath?: string,\n  fullWidth?: boolean,\n|};\n\ntype TitleAndMessage = {|\n  title: ?string,\n  message: ?string,\n|};\n\nexport default class LocalFolderPicker extends PureComponent<Props, {||}> {\n  _onChooseFolder = ({ title, message }: TitleAndMessage) => {\n    if (!dialog || !electron) return;\n\n    const browserWindow = electron.remote.getCurrentWindow();\n    dialog\n      .showOpenDialog(browserWindow, {\n        title,\n        properties: ['openDirectory', 'createDirectory'],\n        message,\n        defaultPath: this.props.defaultPath,\n      })\n      .then(({ filePaths }) => {\n        if (!filePaths || !filePaths.length) return;\n        this.props.onChange(filePaths[0]);\n      });\n  };\n\n  _getTitleAndMessage = (i18n: I18nType): TitleAndMessage => {\n    const { type } = this.props;\n    if (type === 'export') {\n      return {\n        title: i18n._(t`Choose an export folder`),\n        message: i18n._(t`Choose where to export the game`),\n      };\n    } else if (type === 'create-game') {\n      return {\n        title: i18n._(t`Choose a folder for the new game`),\n        message: i18n._(t`Choose where to create the game`),\n      };\n    }\n\n    return {\n      title: undefined,\n      message: undefined,\n    };\n  };\n\n  render() {\n    return (\n      <I18n>\n        {({ i18n }) => {\n          const titleAndMessage = this._getTitleAndMessage(i18n);\n          return (\n            <div\n              style={{\n                ...styles.container,\n                width: this.props.fullWidth ? '100%' : undefined,\n              }}\n            >\n              <TextField\n                margin=\"dense\"\n                style={styles.textField}\n                type=\"text\"\n                hintText={titleAndMessage.title}\n                value={this.props.value}\n                onChange={(event, value) => this.props.onChange(value)}\n              />\n              <RaisedButton\n                label={<Trans>Choose folder</Trans>}\n                primary={false}\n                style={styles.button}\n                onClick={() => this._onChooseFolder(titleAndMessage)}\n              />\n            </div>\n          );\n        }}\n      </I18n>\n    );\n  }\n}\n","// @flow\n\nimport optionalRequire from './OptionalRequire.js';\nconst fs = optionalRequire('fs');\nconst archiver = optionalRequire('archiver');\n\n// TODO: Move in a Archiver folder?\n/**\n * Archive the given folder to a file. Only available when running on Electron runtime.\n */\nexport const archiveLocalFolder = ({\n  path,\n  outputFilename,\n}: {|\n  path: string,\n  outputFilename: string,\n|}): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    if (!fs || !archiver) return reject(new Error('Archiver unavailable'));\n\n    const output = fs.createWriteStream(outputFilename);\n    const archive = archiver('zip', {\n      zlib: { level: 9 }, // Sets the compression level.\n    });\n\n    output.on('close', () => {\n      console.log(\n        `Archive written at ${outputFilename}, ${archive.pointer()} total bytes.`\n      );\n      resolve(outputFilename);\n    });\n\n    archive.on('error', err => {\n      reject(err);\n    });\n\n    archive.pipe(output);\n\n    archive.directory(path, false);\n\n    archive.finalize();\n  });\n};\n","// @flow\nimport optionalRequire from '../../Utils/OptionalRequire';\nconst electron = optionalRequire('electron');\nconst ipcRenderer = electron ? electron.ipcRenderer : null;\n\ntype UploadOptions = {\n  signedUrl: string,\n  contentType: string,\n};\n\nexport const uploadLocalFile = (\n  localFilePath: string,\n  uploadOptions: UploadOptions,\n  onProgress: (progress: number, total: number) => void\n): Promise<void> => {\n  if (!ipcRenderer) return Promise.reject('No support for local file upload');\n\n  ipcRenderer.removeAllListeners('local-file-upload-progress');\n  ipcRenderer.removeAllListeners('local-file-upload-done');\n\n  return new Promise((resolve, reject) => {\n    ipcRenderer.on(\n      'local-file-upload-progress',\n      (event, stepCurrentProgress, stepMaxProgress) => {\n        onProgress(stepCurrentProgress, stepMaxProgress);\n      }\n    );\n    ipcRenderer.on('local-file-upload-done', (event, err) => {\n      if (err) return reject(err);\n      resolve();\n    });\n    ipcRenderer.send('local-file-upload', localFilePath, uploadOptions);\n  });\n};\n","// @flow\nimport optionalRequire from '../../Utils/OptionalRequire.js';\nimport { type FileMetadata } from '../index';\nimport { unsplit } from '../../Utils/ObjectSplitter.js';\nconst fs = optionalRequire('fs');\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst dialog = electron ? electron.remote.dialog : null;\n\nconst readJSONFile = (filepath: string): Promise<Object> => {\n  if (!fs) return Promise.reject('Filesystem is not supported.');\n\n  return new Promise((resolve, reject) => {\n    fs.readFile(filepath, { encoding: 'utf8' }, (err, data) => {\n      if (err) return reject(err);\n\n      try {\n        const dataObject = JSON.parse(data);\n        return resolve(dataObject);\n      } catch (ex) {\n        return reject(filepath + ' is a corrupted/malformed file.');\n      }\n    });\n  });\n};\n\nexport const onOpenWithPicker = (): Promise<?FileMetadata> => {\n  if (!dialog) return Promise.reject('Not supported');\n  const browserWindow = electron.remote.getCurrentWindow();\n\n  return dialog\n    .showOpenDialog(browserWindow, {\n      title: 'Open a project',\n      properties: ['openFile'],\n      message:\n        'If you want to open your GDevelop 4 project, be sure to save it as a .json file',\n      filters: [{ name: 'GDevelop 5 project', extensions: ['json'] }],\n    })\n    .then(({ filePaths }) => {\n      if (!filePaths || !filePaths.length) return null;\n      return { fileIdentifier: filePaths[0] };\n    });\n};\n\nexport const onOpen = (\n  fileMetadata: FileMetadata\n): Promise<{|\n  content: Object,\n|}> => {\n  const filePath = fileMetadata.fileIdentifier;\n  const projectPath = path.dirname(filePath);\n  return readJSONFile(filePath).then(object => {\n    return unsplit(object, {\n      getReferencePartialObject: referencePath => {\n        return readJSONFile(path.join(projectPath, referencePath) + '.json');\n      },\n      isReferenceMagicPropertyName: '__REFERENCE_TO_SPLIT_OBJECT',\n      // Limit unsplitting to depth 3 (which would allow properties of layouts/external layouts/external events\n      // to be un-splitted, but not the content of these properties), to avoid very slow processing\n      // of large game files.\n      maxUnsplitDepth: 3,\n    }).then(() => {\n      return { content: object };\n    });\n  });\n};\n\nexport const hasAutoSave = (\n  fileMetadata: FileMetadata,\n  compareLastModified: boolean\n): Promise<boolean> => {\n  const filePath = fileMetadata.fileIdentifier;\n  const autoSavePath = filePath + '.autosave';\n  if (fs.existsSync(autoSavePath)) {\n    if (!compareLastModified) {\n      return Promise.resolve(true);\n    }\n    try {\n      const autoSavedTime = fs.statSync(autoSavePath).mtime.getTime();\n      const saveTime = fs.statSync(filePath).mtime.getTime();\n      if (autoSavedTime > saveTime) {\n        return Promise.resolve(true);\n      }\n    } catch (err) {\n      console.error('Unable to compare *.autosave to project', err);\n      return Promise.resolve(false);\n    }\n    return Promise.resolve(false);\n  }\n  return Promise.resolve(false);\n};\n\nexport const onGetAutoSave = (fileMetadata: FileMetadata) => {\n  return Promise.resolve({\n    ...fileMetadata,\n    fileIdentifier: fileMetadata.fileIdentifier + '.autosave',\n  });\n};\n","// @flow\nimport { t } from '@lingui/macro';\nimport { type StorageProvider } from '../index';\nimport {\n  onOpenWithPicker,\n  onOpen,\n  hasAutoSave,\n  onGetAutoSave,\n} from './LocalProjectOpener';\nimport {\n  onSaveProject,\n  onSaveProjectAs,\n  onAutoSaveProject,\n} from './LocalProjectWriter';\nimport {\n  type AppArguments,\n  POSITIONAL_ARGUMENTS_KEY,\n} from '../../Utils/Window';\nimport { type MessageDescriptor } from '../../Utils/i18n/MessageDescriptor.flow';\n\n/**\n * Use the Electron APIs to provide access to the native\n * file system (with native save/open dialogs).\n */\nexport default ({\n  internalName: 'LocalFile',\n  name: t`Local file system`,\n  getFileMetadataFromAppArguments: (appArguments: AppArguments) => {\n    if (!appArguments[POSITIONAL_ARGUMENTS_KEY]) return null;\n    if (!appArguments[POSITIONAL_ARGUMENTS_KEY].length) return null;\n\n    return {\n      fileIdentifier: appArguments[POSITIONAL_ARGUMENTS_KEY][0],\n    };\n  },\n  createOperations: () => ({\n    onOpenWithPicker,\n    onOpen,\n    hasAutoSave,\n    onSaveProject,\n    onSaveProjectAs,\n    onAutoSaveProject,\n    onGetAutoSave,\n    getOpenErrorMessage: (error: Error): MessageDescriptor => {\n      return t`Check that the file exists, that this file is a proper game created with GDevelop and that you have the authorizations to open it.`;\n    },\n  }),\n}: StorageProvider);\n","// @flow\nimport React from 'react';\nimport MainFrame from './MainFrame';\nimport Window from './Utils/Window';\nimport ExportDialog from './Export/ExportDialog';\nimport CreateProjectDialog from './ProjectCreation/CreateProjectDialog';\nimport Authentification from './Utils/GDevelopServices/Authentification';\nimport './UI/iconmoon-font.css'; // Styles for Iconmoon font.\n\n// Import for Electron powered IDE.\nimport LocalExamples from './ProjectCreation/LocalExamples';\nimport LocalStarters from './ProjectCreation/LocalStarters';\nimport localResourceSources from './ResourcesList/LocalResourceSources';\nimport localResourceExternalEditors from './ResourcesList/LocalResourceExternalEditors';\nimport LocalPreviewLauncher from './Export/LocalExporters/LocalPreviewLauncher';\nimport { getLocalExporters } from './Export/LocalExporters';\nimport ElectronMainMenu from './MainFrame/ElectronMainMenu';\nimport makeExtensionsLoader from './JsExtensionsLoader/LocalJsExtensionsLoader';\nimport { makeLocalEventsFunctionCodeWriter } from './EventsFunctionsExtensionsLoader/CodeWriters/LocalEventsFunctionCodeWriter';\nimport ObjectsEditorService from './ObjectEditor/ObjectsEditorService';\nimport ObjectsRenderingService from './ObjectsRendering/ObjectsRenderingService';\nimport Providers from './MainFrame/Providers';\nimport LocalEventsFunctionsExtensionWriter from './EventsFunctionsExtensionsLoader/Storage/LocalEventsFunctionsExtensionWriter';\nimport LocalEventsFunctionsExtensionOpener from './EventsFunctionsExtensionsLoader/Storage/LocalEventsFunctionsExtensionOpener';\nimport ProjectStorageProviders from './ProjectsStorage/ProjectStorageProviders';\nimport LocalFileStorageProvider from './ProjectsStorage/LocalFileStorageProvider';\nimport { LocalGDJSDevelopmentWatcher } from './GameEngineFinder/LocalGDJSDevelopmentWatcher';\nimport UnsavedChangesContext from './MainFrame/UnsavedChangesContext';\n\nconst gd = global.gd;\n\nexport const create = (authentification: Authentification) => {\n  Window.setUpContextMenu();\n\n  const appArguments = Window.getArguments();\n  const isDev = Window.isDev();\n\n  return (\n    <Providers\n      authentification={authentification}\n      disableCheckForUpdates={!!appArguments['disable-update-check']}\n      eventsFunctionCodeWriter={makeLocalEventsFunctionCodeWriter()}\n      eventsFunctionsExtensionWriter={LocalEventsFunctionsExtensionWriter}\n      eventsFunctionsExtensionOpener={LocalEventsFunctionsExtensionOpener}\n    >\n      {({ i18n, eventsFunctionsExtensionsState }) => (\n        <ProjectStorageProviders\n          appArguments={appArguments}\n          storageProviders={[LocalFileStorageProvider]}\n          defaultStorageProvider={LocalFileStorageProvider}\n        >\n          {({\n            currentStorageProviderOperations,\n            useStorageProvider,\n            storageProviders,\n            initialFileMetadataToOpen,\n          }) => (\n            <UnsavedChangesContext.Consumer>\n              {unsavedChanges => (\n                <MainFrame\n                  i18n={i18n}\n                  renderMainMenu={props => <ElectronMainMenu {...props} />}\n                  eventsFunctionsExtensionsState={\n                    eventsFunctionsExtensionsState\n                  }\n                  renderPreviewLauncher={(props, ref) => (\n                    <LocalPreviewLauncher {...props} ref={ref} />\n                  )}\n                  renderExportDialog={props => (\n                    <ExportDialog {...props} exporters={getLocalExporters()} />\n                  )}\n                  renderCreateDialog={props => (\n                    <CreateProjectDialog\n                      {...props}\n                      examplesComponent={LocalExamples}\n                      startersComponent={LocalStarters}\n                    />\n                  )}\n                  renderGDJSDevelopmentWatcher={\n                    isDev ? () => <LocalGDJSDevelopmentWatcher /> : null\n                  }\n                  storageProviders={storageProviders}\n                  useStorageProvider={useStorageProvider}\n                  storageProviderOperations={currentStorageProviderOperations}\n                  resourceSources={localResourceSources}\n                  resourceExternalEditors={localResourceExternalEditors}\n                  extensionsLoader={makeExtensionsLoader({\n                    gd,\n                    objectsEditorService: ObjectsEditorService,\n                    objectsRenderingService: ObjectsRenderingService,\n                    filterExamples: !isDev,\n                  })}\n                  initialFileMetadataToOpen={initialFileMetadataToOpen}\n                  unsavedChanges={unsavedChanges}\n                />\n              )}\n            </UnsavedChangesContext.Consumer>\n          )}\n        </ProjectStorageProviders>\n      )}\n    </Providers>\n  );\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport { t } from '@lingui/macro';\nimport { I18n } from '@lingui/react';\nimport { type I18n as I18nType } from '@lingui/core';\nimport React, { Component } from 'react';\nimport Divider from '@material-ui/core/Divider';\nimport LocalFolderPicker from '../UI/LocalFolderPicker';\nimport Text from '../UI/Text';\nimport { sendNewGameCreated } from '../Utils/Analytics/EventSender';\nimport { Column, Line } from '../UI/Grid';\nimport { findExamples } from './LocalExamplesFinder';\nimport optionalRequire from '../Utils/OptionalRequire.js';\nimport { findEmptyPath } from './LocalPathFinder';\nimport ExamplesList from './ExamplesList';\nimport { showWarningBox } from '../UI/Messages/MessageBox';\nimport { type StorageProvider, type FileMetadata } from '../ProjectsStorage';\nimport LocalFileStorageProvider from '../ProjectsStorage/LocalFileStorageProvider';\nconst path = optionalRequire('path');\nconst electron = optionalRequire('electron');\nconst app = electron ? electron.remote.app : null;\nvar fs = optionalRequire('fs-extra');\n\n// To add a new example, add it first in resources/examples (at which point you can see it\n// in the desktop version), then run these scripts:\n// * scripts/update-examples-information-from-resources-examples.js (update metadata)\n// * scripts/update-fixtures-from-resources-examples.js (update web-app examples)\n// and upload the examples to `gdevelop-resources` s3.\n\ntype Props = {|\n  onOpen: (\n    storageProvider: StorageProvider,\n    fileMetadata: FileMetadata\n  ) => void,\n  onExamplesLoaded: () => void,\n|};\n\ntype State = {|\n  outputPath: string,\n  exampleNames: ?Array<string>,\n|};\n\nexport const showGameFileCreationError = (\n  i18n: I18nType,\n  outputPath: string,\n  error: Error\n) => {\n  showWarningBox(\n    i18n._(\n      t`Unable to create the game in the specified folder. Check that you have permissions to write in this folder: ${outputPath} or choose another folder.`\n    ),\n    error\n  );\n};\n\nexport default class LocalExamples extends Component<Props, State> {\n  state = {\n    outputPath: findEmptyPath(\n      path && app\n        ? path.join(app.getPath('documents'), 'GDevelop projects')\n        : ''\n    ),\n    exampleNames: null,\n  };\n\n  componentDidMount() {\n    findExamples(examplesPath => {\n      fs.readdir(examplesPath, (error, exampleNames) => {\n        if (error) {\n          console.error('Unable to read examples:', error);\n          return;\n        }\n\n        this.setState(\n          {\n            exampleNames: exampleNames.filter(name => name !== '.DS_Store'),\n          },\n          () => this.props.onExamplesLoaded()\n        );\n      });\n    });\n  }\n\n  _handleChangePath = (outputPath: string) =>\n    this.setState({\n      outputPath,\n    });\n\n  createFromExample = (i18n: I18nType, exampleName: string) => {\n    const { outputPath } = this.state;\n    if (!fs || !outputPath) return;\n\n    findExamples(examplesPath => {\n      try {\n        fs.mkdirsSync(outputPath);\n        fs.copySync(path.join(examplesPath, exampleName), outputPath);\n      } catch (error) {\n        showGameFileCreationError(i18n, outputPath, error);\n        return;\n      }\n\n      this.props.onOpen(LocalFileStorageProvider, {\n        fileIdentifier: path.join(outputPath, exampleName + '.json'),\n      });\n      sendNewGameCreated(exampleName);\n    });\n  };\n\n  render() {\n    return (\n      <I18n>\n        {({ i18n }) => (\n          <Column noMargin>\n            <Line>\n              <Column>\n                <Text>\n                  <Trans>Choose or search for an example to open:</Trans>\n                </Text>\n              </Column>\n            </Line>\n            <Line>\n              <ExamplesList\n                exampleNames={this.state.exampleNames}\n                onCreateFromExample={exampleName =>\n                  this.createFromExample(i18n, exampleName)\n                }\n              />\n            </Line>\n            <Divider />\n            <Line expand>\n              <Column expand>\n                <LocalFolderPicker\n                  fullWidth\n                  value={this.state.outputPath}\n                  onChange={this._handleChangePath}\n                  type=\"create-game\"\n                />\n              </Column>\n            </Line>\n          </Column>\n        )}\n      </I18n>\n    );\n  }\n}\n","// @flow\n\nimport optionalRequire from '../Utils/OptionalRequire.js';\nconst electron = optionalRequire('electron');\nconst path = optionalRequire('path');\nconst app = electron ? electron.remote.app : null;\nconst fs = optionalRequire('fs');\nconst process = optionalRequire('process');\n\nconst tryPath = (\n  path: string,\n  onExists: string => void,\n  onNoAccess: Function\n) =>\n  fs.access(path, fs.constants.R_OK, err => {\n    if (!err) onExists(path);\n    else onNoAccess();\n  });\n\nexport const findExamples = (cb: (?string) => void) => {\n  if (!process || !fs) return '';\n\n  const appPath = app ? app.getAppPath() : process.cwd();\n\n  // First try to find examples in app resources folder\n  tryPath(path.join(appPath, '..', 'examples'), cb, () => {\n    tryPath(\n      path.join(appPath, '..', '..', 'app', 'resources', 'examples'),\n      cb,\n      () => {\n        cb(null);\n      }\n    );\n  });\n};\n","import generateName from '../Utils/NewNameGenerator';\nimport optionalRequire from '../Utils/OptionalRequire.js';\nconst path = optionalRequire('path');\nvar fs = optionalRequire('fs-extra');\n\nexport const findEmptyPath = basePath => {\n  if (!path) return basePath;\n\n  const folderName = generateName('My project', name => {\n    try {\n      fs.accessSync(path.join(basePath, name));\n    } catch (ex) {\n      return false;\n    }\n    return true;\n  });\n\n  return path.join(basePath, folderName);\n};\n","// @flow\n// TODO: This module could be published on npm if useful.\nimport newNameGenerator from './NewNameGenerator';\nimport slugs from 'slugs';\n\ntype PartialObjectDescription = {|\n  reference: string,\n  object: Object,\n|};\n\ntype Reference = {\n  referenceTo: string,\n};\n\ntype SplitConfiguration = {|\n  pathSeparator: string,\n  getArrayItemReferenceName: (\n    object: Object,\n    currentReference: string\n  ) => string,\n  shouldSplit: (path: string) => boolean,\n  isReferenceMagicPropertyName: string,\n|};\n\ntype UnsplitConfiguration = {|\n  isReferenceMagicPropertyName: string,\n  getReferencePartialObject: (referencePath: string) => Promise<Object>,\n  maxUnsplitDepth?: number,\n|};\n\n/**\n * Mutate the given object to split it into multiple partial objects.\n * Partial objects will be replaced by references.\n *\n * @param object The object to be split.\n * @param configuration Configuration to be used to split the object.\n */\nexport const split = (\n  object: Object,\n  {\n    pathSeparator,\n    getArrayItemReferenceName,\n    shouldSplit,\n    isReferenceMagicPropertyName,\n  }: SplitConfiguration\n): Array<PartialObjectDescription> => {\n  const partialObjects = [];\n  const createReference = (reference, object): Reference => {\n    partialObjects.push({\n      reference,\n      object,\n    });\n\n    return {\n      [isReferenceMagicPropertyName]: true,\n      referenceTo: reference,\n    };\n  };\n\n  const splitObject = (\n    currentObject: Object,\n    currentPath: string,\n    currentReference: string\n  ) => {\n    if (currentObject !== null && typeof currentObject === 'object') {\n      if (Array.isArray(currentObject)) {\n        for (let index in currentObject) {\n          const itemPath = currentPath + pathSeparator + '*';\n          if (shouldSplit(itemPath)) {\n            const partialObject = currentObject[index];\n            const name = getArrayItemReferenceName(\n              partialObject,\n              currentReference\n            );\n            const itemReference = currentReference + pathSeparator + name;\n\n            currentObject[index] = createReference(\n              itemReference,\n              partialObject\n            );\n\n            splitObject(partialObject, itemPath, itemReference);\n          } else {\n            const itemReference = currentReference + pathSeparator + index;\n\n            splitObject(currentObject[index], itemPath, itemReference);\n          }\n        }\n      } else {\n        for (let propertyName in currentObject) {\n          const propertyPath = currentPath + pathSeparator + propertyName;\n          const propertyReference =\n            currentReference + pathSeparator + propertyName;\n          if (shouldSplit(propertyPath)) {\n            const partialObject = currentObject[propertyName];\n\n            currentObject[propertyName] = createReference(\n              propertyReference,\n              partialObject\n            );\n\n            splitObject(partialObject, propertyPath, propertyReference);\n          } else {\n            splitObject(\n              currentObject[propertyName],\n              propertyPath,\n              propertyReference\n            );\n          }\n        }\n      }\n    }\n  };\n\n  splitObject(object, '', '');\n  return partialObjects;\n};\n\n/**\n * Mutate the given object to recompose it from partial objects.\n * References to partial objects will be fetched as needed.\n *\n * @param object The object to be unsplit.\n * @param configuration Configuration to be used to unsplit the object.\n */\nexport const unsplit = (\n  object: Object,\n  {\n    isReferenceMagicPropertyName,\n    getReferencePartialObject,\n    maxUnsplitDepth,\n  }: UnsplitConfiguration\n): Promise<void> => {\n  const isReference = (object: Object): ?Reference => {\n    if (object[isReferenceMagicPropertyName] === true) {\n      return object;\n    }\n\n    return null;\n  };\n\n  const unsplitObject = (\n    currentObject: Object,\n    depth: number\n  ): Promise<void> => {\n    if (maxUnsplitDepth !== undefined && depth >= maxUnsplitDepth) {\n      return Promise.resolve();\n    }\n\n    if (currentObject !== null && typeof currentObject === 'object') {\n      const keys = Object.keys(currentObject);\n      if (keys) {\n        return Promise.all(\n          keys.map(indexOrPropertyName => {\n            const reference = isReference(currentObject[indexOrPropertyName]);\n            if (reference) {\n              return getReferencePartialObject(reference.referenceTo).then(\n                partialObject => {\n                  currentObject[indexOrPropertyName] = partialObject;\n\n                  return unsplitObject(\n                    currentObject[indexOrPropertyName],\n                    depth + 1\n                  );\n                }\n              );\n            }\n\n            return unsplitObject(currentObject[indexOrPropertyName], depth + 1);\n          })\n        ).then(() => {});\n      }\n    }\n\n    return Promise.resolve();\n  };\n\n  return unsplitObject(object, 0);\n};\n\n/**\n * A helper that can be used to split according to a list of hardcoded paths\n */\nexport const splitPaths = (paths: Set<string>) => {\n  return (path: string) => paths.has(path);\n};\n\n/**\n * A helper that can be used to get the name of items in array using an hardcoded property name.\n */\nexport const getNameFromProperty = (propertyName: string) => {\n  return (object: Object): string => {\n    const property = object[propertyName];\n    if (typeof property !== 'string') {\n      throw new Error(`Property ${propertyName} is not a string`);\n    }\n\n    return property;\n  };\n};\n\n/**\n * A helper that can be used to get the name of items in array using an hardcoded property name.\n */\nexport const getSlugifiedUniqueNameFromProperty = (propertyName: string) => {\n  const existingNamesForReference = {};\n\n  return (object: Object, currentReference: string): string => {\n    const property = object[propertyName];\n    if (typeof property !== 'string') {\n      throw new Error(`Property ${propertyName} is not a string`);\n    }\n\n    existingNamesForReference[currentReference] =\n      existingNamesForReference[currentReference] || {};\n    const newName = newNameGenerator(\n      slugs(property),\n      name => !!existingNamesForReference[currentReference][name]\n    );\n    existingNamesForReference[currentReference][newName] = true;\n    return newName;\n  };\n};\n"],"sourceRoot":""}