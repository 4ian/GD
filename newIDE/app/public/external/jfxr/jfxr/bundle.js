!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.jfxr=t():e.jfxr=t()}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){(function(n){var a,i,o;i=[],void 0===(o="function"==typeof(a=function(){"use strict";function t(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){r(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function a(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o=function(){try{return Function("return this")()||(0,eval)("this")}catch(e){return"object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:this}}(),r=o.saveAs||"object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype?function(e,n,r){var s=o.URL||o.webkitURL,u=document.createElement("a");n=n||e.name||"download",u.download=n,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?i(u):a(u.href)?t(e,n,r):i(u,u.target="_blank")):(u.href=s.createObjectURL(e),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){i(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,o){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Depricated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),n);else if(a(e))t(e,n,o);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout(function(){i(r)})}}:function(e,n,a,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,a);var r="application/octet-stream"===e.type,s=/constructor/i.test(o.HTMLElement)||o.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||r&&s)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},l.readAsDataURL(e)}else{var h=o.URL||o.webkitURL,c=h.createObjectURL(e);i?i.location=c:location.href=c,i=null,setTimeout(function(){h.revokeObjectURL(c)},4e4)}};o.saveAs=r.saveAs=r,e.exports=r})?a.apply(t,i):a)||(e.exports=o)}).call(this,n(1))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function a(e){return+e===e?0===e?e:e>0?1:-1:NaN}function i(e){return e-Math.floor(e)}function o(e,t,n){return n<e?e:n>t?t:n}function r(e,t){return Math.round(e/t)*t}function s(e,t,n){return(1-n)*e+n*t}function u(e,t){this.array=e,this.sampleRate=t}n.r(t),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,u.prototype.getSampleRate=function(){return this.sampleRate},u.prototype.getNumSamples=function(){return this.array.length},u.prototype.toFloat32Array=function(){return this.array},u.prototype.toWavBytes=function(){var e=this.array,t=e.length,n=44+2*t,a=new Uint8Array(n),i=0;function r(e){a[i++]=e}function s(e){for(var t=0;t<e.length;t++)r(e.charCodeAt(t))}function u(e){r(255&e),r(255&(e>>=8))}function l(e){r(255&e),r(255&(e>>=8)),r(255&(e>>=8)),r(255&(e>>=8))}s("RIFF"),l(n-8),s("WAVE"),s("fmt "),l(16),u(1),u(1),l(this.sampleRate),l(2*this.sampleRate),u(2),u(16),s("data"),l(2*t);for(var h=0;h<e.length;h++)u(o(-32768,32767,Math.round(32768*e[h])));return a};var l=function(e){this.label=e.label||"<unnamed>",this.description=e.description||"<no description>",this.unit=e.unit||"",this.type=e.type||"float";var t="float"==this.type||"int"==this.type;this.value_=e.defaultValue,this.defaultValue=this.value_,this.values="enum"==this.type?e.values||{}:null,this.minValue=t?e.minValue:null,this.maxValue=t?e.maxValue:null,this.step=t?e.step||"any":null,this.logarithmic=!("float"!=this.type||!e.logarithmic),this.digits="float"==this.type?Math.max(0,Math.round(-Math.log(this.step)/Math.log(10))):null,this.disabledReason_=e.disabledReason||null,this.locked=!1};Object.defineProperty(l.prototype,"value",{enumerable:!0,get:function(){return this.value_},set:function(e){switch(this.type){case"float":case"int":if("string"==typeof e&&(e=parseFloat(e)),e!=e)break;"int"==this.type&&(e=Math.round(e)),null!==this.minValue&&e<this.minValue&&(e=this.minValue),null!==this.maxValue&&e>this.maxValue&&(e=this.maxValue),this.value_=e;break;case"enum":if(e=""+e,!this.values[e])return;this.value_=e;break;case"boolean":this.value_=!!e}}}),l.prototype.valueTitle=function(){return"enum"==this.type?this.values[this.value_]:"boolean"==this.type?this.value_?"Enabled":"Disabled":void 0},l.prototype.isDisabled=function(e){return!(!this.disabledReason_||!this.disabledReason_(e))},l.prototype.whyDisabled=function(e){return this.disabledReason_&&this.disabledReason_(e)},l.prototype.toggleLocked=function(){this.locked=!this.locked},l.prototype.reset=function(){this.value=this.defaultValue},l.prototype.hasDefaultValue=function(){return this.value==this.defaultValue};var h=function(){this.name="Unnamed";var e=function(e){return"square"!=e.waveform.value?"Duty cycle only applies to square waveforms":null};this.sampleRate=new l({label:"Sample rate",unit:"Hz",defaultValue:44100,minValue:44100,maxValue:44100,disabledReason:function(){return"Sample rate is currently not configurable"}}),this.attack=new l({label:"Attack",description:'Time from the start of the sound until the point where it reaches its maximum volume. Increase this for a gradual fade-in; decrease it to add more "punch".',unit:"s",defaultValue:0,minValue:0,maxValue:5,step:.01,logarithmic:!0}),this.sustain=new l({label:"Sustain",description:"Amount of time for which the sound holds its maximum volume after the attack phase. Increase this to increase the sound's duration.",unit:"s",defaultValue:0,minValue:0,maxValue:5,step:.01,logarithmic:!0}),this.sustainPunch=new l({label:"Sustain punch",description:'Additional volume at the start of the sustain phase, which linearly fades back to the base level. Use this to add extra "punch" to the sustain phase.',unit:"%",defaultValue:0,minValue:0,maxValue:100,step:10}),this.decay=new l({label:"Decay",description:"Time it takes from the end of the sustain phase until the sound has faded away. Increase this for a gradual fade-out.",unit:"s",defaultValue:0,minValue:0,maxValue:5,step:.01,logarithmic:!0}),this.tremoloDepth=new l({label:"Tremolo depth",description:"Amount by which the volume oscillates as a sine wave around its base value.",unit:"%",defaultValue:0,minValue:0,maxValue:100,step:1}),this.tremoloFrequency=new l({label:"Tremolo frequency",description:"Frequency at which the volume oscillates as a sine wave around its base value.",unit:"Hz",defaultValue:10,minValue:0,maxValue:1e3,step:1,logarithmic:!0}),this.frequency=new l({label:"Frequency",description:"Initial frequency, or pitch, of the sound. This determines how high the sound starts out; higher values result in higher notes.",unit:"Hz",defaultValue:500,minValue:10,maxValue:1e4,step:100,logarithmic:!0}),this.frequencySweep=new l({label:"Frequency sweep",description:"Amount by which the frequency is changed linearly over the duration of the sound.",unit:"Hz",defaultValue:0,minValue:-1e4,maxValue:1e4,step:100,logarithmic:!0}),this.frequencyDeltaSweep=new l({label:"Freq. delta sweep",description:"Amount by which the frequency is changed quadratically over the duration of the sound.",unit:"Hz",defaultValue:0,minValue:-1e4,maxValue:1e4,step:100,logarithmic:!0}),this.repeatFrequency=new l({label:"Repeat frequency",description:"Amount of times per second that the frequency is reset to its base value, and starts its sweep cycle anew.",unit:"Hz",defaultValue:0,minValue:0,maxValue:100,step:.1,logarithmic:!0}),this.frequencyJump1Onset=new l({label:"Freq. jump 1 onset",description:"Point in time, as a fraction of the repeat cycle, at which the frequency makes a sudden jump.",unit:"%",defaultValue:33,minValue:0,maxValue:100,step:5}),this.frequencyJump1Amount=new l({label:"Freq. jump 1 amount",description:"Amount by which the frequency jumps at the given onset, as a fraction of the current frequency.",unit:"%",defaultValue:0,minValue:-100,maxValue:100,step:5}),this.frequencyJump2Onset=new l({label:"Freq. jump 2 onset",description:"Point in time, as a fraction of the repeat cycle, at which the frequency makes a sudden jump.",unit:"%",defaultValue:66,minValue:0,maxValue:100,step:5}),this.frequencyJump2Amount=new l({label:"Freq. jump 2 amount",description:"Amount by which the frequency jumps at the given onset, as a fraction of the current frequency.",unit:"%",defaultValue:0,minValue:-100,maxValue:100,step:5}),this.harmonics=new l({label:"Harmonics",description:"Number of harmonics (overtones) to add. Generates the same sound at several multiples of the base frequency (2×, 3×, …), and mixes them with the original sound. Note that this slows down rendering quite a lot, so you may want to leave it at 0 until the last moment.",type:"int",defaultValue:0,minValue:0,maxValue:5,step:1}),this.harmonicsFalloff=new l({label:"Harmonics falloff",description:"Volume of each subsequent harmonic, as a fraction of the previous one.",defaultValue:.5,minValue:0,maxValue:1,step:.01}),this.waveform=new l({label:"Waveform",description:"Shape of the waveform. This is the most important factor in determining the character, or timbre, of the sound.",defaultValue:"sine",type:"enum",values:{sine:"Sine",triangle:"Triangle",sawtooth:"Sawtooth",square:"Square",tangent:"Tangent",whistle:"Whistle",breaker:"Breaker",whitenoise:"White noise",pinknoise:"Pink noise",brownnoise:"Brown noise"}}),this.interpolateNoise=new l({label:"Interpolate noise",description:"Whether to use linear interpolation between individual samples of noise. This results in a smoother sound.",defaultValue:!0,type:"boolean",disabledReason:function(e){var t=e.waveform.value;if("whitenoise"!=t&&"pinknoise"!=t&&"brownnoise"!=t)return"Noise interpolation only applies to noise waveforms"}}),this.vibratoDepth=new l({label:"Vibrato depth",description:"Amount by which to vibrate around the base frequency.",unit:"Hz",defaultValue:0,minValue:0,maxValue:1e3,step:10,logarithmic:!0}),this.vibratoFrequency=new l({label:"Vibrato frequency",description:"Number of times per second to vibrate around the base frequency.",unit:"Hz",defaultValue:10,minValue:0,maxValue:1e3,step:1,logarithmic:!0}),this.squareDuty=new l({label:"Square duty",description:'For square waves only, the initial fraction of time the square is in the "on" state.',unit:"%",defaultValue:50,minValue:0,maxValue:100,step:5,disabledReason:e}),this.squareDutySweep=new l({label:"Square duty sweep",description:"For square waves only, change the square duty linearly by this many percentage points over the course of the sound.",unit:"%",defaultValue:0,minValue:-100,maxValue:100,step:5,disabledReason:e}),this.flangerOffset=new l({label:"Flanger offset",description:"The initial offset for the flanger effect. Mixes the sound with itself, delayed initially by this amount.",unit:"ms",defaultValue:0,minValue:0,maxValue:50,step:1}),this.flangerOffsetSweep=new l({label:"Flanger offset sweep",description:"Amount by which the flanger offset changes linearly over the course of the sound.",unit:"ms",defaultValue:0,minValue:-50,maxValue:50,step:1}),this.bitCrush=new l({label:"Bit crush",description:"Number of bits per sample. Reduces the number of bits in each sample by this amount, and then increase it again. The result is a lower-fidelity sound effect.",unit:"bits",defaultValue:16,minValue:1,maxValue:16,step:1}),this.bitCrushSweep=new l({label:"Bit crush sweep",description:"Amount by which to change the bit crush value linearly over the course of the sound.",unit:"bits",defaultValue:0,minValue:-16,maxValue:16,step:1}),this.lowPassCutoff=new l({label:"Low-pass cutoff",description:'Threshold above which frequencies should be filtered out, using a simple IIR low-pass filter. Use this to take some "edge" off the sound.',unit:"Hz",defaultValue:22050,minValue:0,maxValue:22050,step:100,logarithmic:!0}),this.lowPassCutoffSweep=new l({label:"Low-pass sweep",description:"Amount by which to change the low-pass cutoff frequency over the course of the sound.",unit:"Hz",defaultValue:0,minValue:-22050,maxValue:22050,step:100,logarithmic:!0}),this.highPassCutoff=new l({label:"High-pass cutoff",description:"Threshold below which frequencies should be filtered out, using a simple high-pass filter.",unit:"Hz",defaultValue:0,minValue:0,maxValue:22050,step:100,logarithmic:!0}),this.highPassCutoffSweep=new l({label:"High-pass sweep",description:"Amount by which to change the high-pass cutoff frequency over the course of the sound.",unit:"Hz",defaultValue:0,minValue:-22050,maxValue:22050,step:100,logarithmic:!0}),this.compression=new l({label:"Compression",description:"Power to which sample values should be raised. 1 is the neutral setting. Use a value less than 1 to increase the volume of quiet parts of the sound, higher than 1 to make quiet parts even quieter.",defaultValue:1,minValue:0,maxValue:5,step:.1}),this.normalization=new l({label:"Normalization",description:"Whether to adjust the volume of the sound so that the peak volume is at 100%.",type:"boolean",defaultValue:!0}),this.amplification=new l({label:"Amplification",description:"Percentage to amplify the sound by, after any normalization has occurred. Note that setting this too high can result in clipping.",unit:"%",defaultValue:100,minValue:0,maxValue:500,step:10})};h.prototype.duration=function(){return this.attack.value+this.sustain.value+this.decay.value},h.prototype.amplitudeAt=function(e){var t,n=this.attack.value,a=this.sustain.value,i=this.sustainPunch.value,o=this.decay.value,r=this.tremoloDepth.value;return t=e<n?e/n:e<n+a?1+i/100*(1-(e-n)/a):1-(e-n-a)/o,0!==r&&(t*=1-r/100*(.5+.5*Math.cos(2*Math.PI*e*this.tremoloFrequency.value))),t},h.prototype.effectiveRepeatFrequency=function(){return Math.max(this.repeatFrequency.value,1/this.duration())},h.prototype.frequencyAt=function(e){var t=i(e*this.effectiveRepeatFrequency()),n=this.frequency.value+t*this.frequencySweep.value+t*t*this.frequencyDeltaSweep.value;return t>this.frequencyJump1Onset.value/100&&(n*=1+this.frequencyJump1Amount.value/100),t>this.frequencyJump2Onset.value/100&&(n*=1+this.frequencyJump2Amount.value/100),0!==this.vibratoDepth.value&&(n+=1-this.vibratoDepth.value*(.5-.5*Math.sin(2*Math.PI*e*this.vibratoFrequency.value))),Math.max(0,n)},h.prototype.squareDutyAt=function(e){var t=i(e*this.effectiveRepeatFrequency());return(this.squareDuty.value+t*this.squareDutySweep.value)/100},h.prototype.forEachParam=function(e){for(var t in this){var n=this[t];n instanceof l&&e(t,n)}},h.prototype.reset=function(){this.forEachParam(function(e,t){t.reset(),t.locked=!1})},h.prototype.clone=function(){var e=new h;return e.parse(this.serialize()),e},h.prototype.serialize=function(){var e={_version:1,_name:this.name,_locked:[]};return this.forEachParam(function(t,n){e[t]=n.value,n.locked&&e._locked.push(t)}),JSON.stringify(e)},h.prototype.parse=function(e){if(this.reset(),e&&""!==e){var t=JSON.parse(e);if(t._version>1)throw new Error("Cannot read this sound; it was written by jfxr version "+t._version+" but we support only up to version 1. Please update the jfxr library.");this.name=t._name||"Unnamed",this.forEachParam(function(e,n){e in t&&(n.value=t[e])});for(var n=t._locked||[],a=0;a<n.length;a++){var i=this[n[a]];i instanceof l&&(i.locked=!0)}}};var c=function(e){e||(e=Date.now()),this.x=4294967295&e,this.y=362436069,this.z=521288629,this.w=88675123;for(var t=0;t<32;t++)this.uint32()};c.prototype.uint32=function(){var e=this.x^this.x<<11&4294967295;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^e^e>>>8,this.w+2147483648},c.prototype.uniform=function(e,t){return void 0===e&&void 0===t?(e=0,t=1):void 0===t&&(t=e,e=0),e+(t-e)*this.uint32()/4294967295},c.prototype.int=function(e,t){return Math.floor(this.uniform(e,t))},c.prototype.boolean=function(e){return this.uniform()<e},c.prototype.fromArray=function(e){return e[this.int(e.length)]};var f=function(e,t){this.setTimeout=t||window.setTimeout.bind(window),this.sound=new h,this.sound.parse(e);var n=this.sound.sampleRate.value,a=Math.max(1,Math.ceil(n*this.sound.duration()));this.array=new Float32Array(a);var i=[f.Generator,f.Envelope,f.Tremolo,f.Flanger,f.BitCrush,f.LowPass,f.HighPass,f.Compress,f.Normalize,f.Amplify];this.transformers=[];for(var o=0;o<i.length;o++)this.transformers.push(new i[o](this.sound,this.array));this.startTime=Date.now(),this.startSample=0,this.blockSize=10240};f.prototype.run=function(e){this.doneCallback||(this.doneCallback=e,this.tick())},f.prototype.isRunning=function(){return!!this.doneCallback},f.prototype.cancel=function(){this.isRunning()&&(this.doneCallback=null)},f.prototype.tick=function(){if(this.isRunning()){for(var e=this.array.length,t=Math.min(e,this.startSample+this.blockSize),n=0;n<this.transformers.length;n++)this.transformers[n].run(this.sound,this.array,this.startSample,t);this.startSample=t,this.startSample==e?(this.renderTimeMs=Date.now()-this.startTime,this.setTimeout(function(){this.doneCallback&&(this.doneCallback(new u(this.array,this.sound.sampleRate.value)),this.doneCallback=null)}.bind(this))):this.tick()}},f.Generator=function(e,t){t.length,e.sampleRate.value;var n={sine:f.SineOscillator,triangle:f.TriangleOscillator,sawtooth:f.SawtoothOscillator,square:f.SquareOscillator,tangent:f.TangentOscillator,whistle:f.WhistleOscillator,breaker:f.BreakerOscillator,whitenoise:f.WhiteNoiseOscillator,pinknoise:f.PinkNoiseOscillator,brownnoise:f.BrownNoiseOscillator}[e.waveform.value],a=1,i=0;this.oscillators=[];for(var o=0;o<=e.harmonics.value;o++)i+=a,a*=e.harmonicsFalloff.value,this.oscillators.push(new n(e));this.firstHarmonicAmp=1/i,this.phase=0,this.prevPhase=0},f.Generator.prototype.run=function(e,t,n,a){for(var o=e.sampleRate.value,r=e.harmonics.value,s=e.harmonicsFalloff.value,u=this.firstHarmonicAmp,l=this.oscillators,h=(new c(1022856099),this.phase),f=n;f<a;f++){var p=f/o;h=i(h+e.frequencyAt(p)/o);for(var d=0,m=u,v=0;v<=r;v++){var y=i(h*(v+1));d+=m*l[v].getSample(y,p),m*=s}t[f]=d}this.phase=h},f.SineOscillator=function(){},f.SineOscillator.prototype.getSample=function(e){return Math.sin(2*Math.PI*e)},f.TriangleOscillator=function(){},f.TriangleOscillator.prototype.getSample=function(e){return e<.25?4*e:e<.75?2-4*e:4*e-4},f.SawtoothOscillator=function(){},f.SawtoothOscillator.prototype.getSample=function(e){return e<.5?2*e:2*e-2},f.SquareOscillator=function(e){this.sound=e},f.SquareOscillator.prototype.getSample=function(e,t){return e<this.sound.squareDutyAt(t)?1:-1},f.TangentOscillator=function(){},f.TangentOscillator.prototype.getSample=function(e){return o(-2,2,.3*Math.tan(Math.PI*e))},f.WhistleOscillator=function(){},f.WhistleOscillator.prototype.getSample=function(e){return.75*Math.sin(2*Math.PI*e)+.25*Math.sin(40*Math.PI*e)},f.BreakerOscillator=function(){},f.BreakerOscillator.prototype.getSample=function(e){var t=i(e+Math.sqrt(.75));return 2*Math.abs(1-t*t*2)-1},f.WhiteNoiseOscillator=function(e){this.interpolateNoise=e.interpolateNoise.value,this.random=new c(1022856099),this.prevPhase=0,this.prevRandom=0,this.currRandom=0},f.WhiteNoiseOscillator.prototype.getSample=function(e){return(e=i(2*e))<this.prevPhase&&(this.prevRandom=this.currRandom,this.currRandom=this.random.uniform(-1,1)),this.prevPhase=e,this.interpolateNoise?s(this.prevRandom,this.currRandom,e):this.currRandom},f.PinkNoiseOscillator=function(e,t){this.interpolateNoise=e.interpolateNoise.value,this.random=new c(1022856099),this.prevPhase=0,this.b=[0,0,0,0,0,0,0],this.prevRandom=0,this.currRandom=0},f.PinkNoiseOscillator.prototype.getSample=function(e){if((e=i(2*e))<this.prevPhase){this.prevRandom=this.currRandom;var t=this.random.uniform(-1,1);this.b[0]=.99886*this.b[0]+.0555179*t,this.b[1]=.99332*this.b[1]+.0750759*t,this.b[2]=.969*this.b[2]+.153852*t,this.b[3]=.8665*this.b[3]+.3104856*t,this.b[4]=.55*this.b[4]+.5329522*t,this.b[5]=-.7616*this.b[5]+.016898*t,this.currRandom=(this.b[0]+this.b[1]+this.b[2]+this.b[3]+this.b[4]+this.b[5]+this.b[6]+.5362*t)/7,this.b[6]=.115926*t}return this.prevPhase=e,this.interpolateNoise?s(this.prevRandom,this.currRandom,e):this.currRandom},f.BrownNoiseOscillator=function(e,t){this.interpolateNoise=e.interpolateNoise.value,this.random=new c(1022856099),this.prevPhase=0,this.prevRandom=0,this.currRandom=0},f.BrownNoiseOscillator.prototype.getSample=function(e){return(e=i(2*e))<this.prevPhase&&(this.prevRandom=this.currRandom,this.currRandom=o(-1,1,this.currRandom+.1*this.random.uniform(-1,1))),this.prevPhase=e,this.interpolateNoise?s(this.prevRandom,this.currRandom,e):this.currRandom},f.Tremolo=function(e,t){},f.Tremolo.prototype.run=function(e,t,n,a){var i=e.sampleRate.value,o=e.tremoloDepth.value,r=e.tremoloFrequency.value;if(0!==o)for(var s=n;s<a;s++){var u=s/i;t[s]*=1-o/100*(.5+.5*Math.cos(2*Math.PI*u*r))}},f.Flanger=function(e,t){0===e.flangerOffset.value&&0===e.flangerOffsetSweep.value||(this.buffer=new Float32Array(Math.ceil(.1*e.sampleRate.value)),this.bufferPos=0)},f.Flanger.prototype.run=function(e,t,n,a){if(this.buffer){for(var i=t.length,r=e.sampleRate.value,s=e.flangerOffset.value,u=e.flangerOffsetSweep.value,l=this.buffer,h=this.bufferPos,c=l.length,f=n;f<a;f++){l[h]=t[f];var p=Math.round((s+f/i*u)/1e3*r);p=o(0,c-1,p),t[f]+=l[(h-p+c)%c],h=(h+1)%c}this.bufferPos=h}},f.BitCrush=function(e,t){},f.BitCrush.prototype.run=function(e,t,n,a){var i=t.length,r=e.bitCrush.value,s=e.bitCrushSweep.value;if(0!==r||0!==s)for(var u=n;u<a;u++){var l=r+u/i*s;l=o(1,16,Math.round(l));var h=Math.pow(2,l);t[u]=2*Math.round((.5+.5*t[u])*h)/h-1}},f.LowPass=function(e,t){this.lowPassPrev=0},f.LowPass.prototype.run=function(e,t,n,a){var i=t.length,r=e.lowPassCutoff.value,s=e.lowPassCutoffSweep.value,u=e.sampleRate.value;if(!(r>=u/2&&r+s>=u/2)){for(var l=this.lowPassPrev,h=n;h<a;h++){var c,f=o(0,u/2,r+h/i*s)/u*Math.PI,p=Math.cos(f);c=p<=0?1:1-(c=1/p-Math.sqrt(1/(p*p)-1));var d=t[h];l=d=c*d+(1-c)*l,t[h]=d}this.lowPassPrev=l}},f.HighPass=function(e,t){this.highPassPrevIn=0,this.highPassPrevOut=0},f.HighPass.prototype.run=function(e,t,n,a){var i=t.length,r=e.sampleRate.value,s=e.highPassCutoff.value,u=e.highPassCutoffSweep.value;if(!(s<=0&&s+u<=0)){for(var l=this.highPassPrevIn,h=this.highPassPrevOut,c=n;c<a;c++){var f=o(0,r/2,s+c/i*u)/r*Math.PI,p=(1-Math.sin(f))/Math.cos(f),d=t[c],m=d;d=p*(h-l+d),l=m,h=d,t[c]=d}this.highPassPrevIn=l,this.highPassPrevOut=h}},f.Envelope=function(e,t){},f.Envelope.prototype.run=function(e,t,n,a){var i=e.sampleRate.value,o=e.attack.value,r=(e.sustain.value,e.sustainPunch.value,e.decay.value);if(0!==o||0!==r)for(var s=n;s<a;s++){var u=s/i;t[s]*=e.amplitudeAt(u)}},f.Compress=function(e,t){},f.Compress.prototype.run=function(e,t,n,a){var i=e.compression.value;if(1!=i)for(var o=n;o<a;o++){var r=t[o];r=r>=0?Math.pow(r,i):-Math.pow(-r,i),t[o]=r}},f.Normalize=function(e,t){this.maxSample=0},f.Normalize.prototype.run=function(e,t,n,a){if(e.normalization.value){var i,o=this.maxSample;for(i=n;i<a;i++)o=Math.max(o,Math.abs(t[i]));this.maxSample=o;var r=t.length;if(a==r){var s=1/o;for(i=0;i<r;i++)t[i]*=s}}},f.Amplify=function(e,t){},f.Amplify.prototype.run=function(e,t,n,a){var i=e.amplification.value/100;if(1!=i)for(var o=n;o<a;o++)t[o]*=i};var p=function(e){this.name=e.name,this.applyTo=e.applyTo||null,this.random=new c};p.prototype.randomize=function(e,t,n){switch(void 0===t&&(t=e.minValue),void 0===n&&(n=e.maxValue),e.type){case"boolean":e.value=this.random.uniform()>=.5;break;case"float":e.value=r(this.random.uniform(t,n),e.step);break;case"int":e.value=this.random.int(t,n);break;case"enum":var a=[];for(var i in e.values)a.push(i);e.value=this.random.fromArray(a)}},p.mutate=function(e){var t=new c;e.forEachParam(function(e,n){if(!n.locked&&"normalization"!=e&&"amplification"!=e)switch(n.type){case"boolean":t.boolean(.1)&&(n.value=!n.value);break;case"float":if(n.value!=n.defaultValue||t.boolean(.3)){var a=.05*(n.maxValue-n.minValue);n.value=r(n.value+t.uniform(-a,a),n.step)}break;case"int":n.value+=t.int(-1,1);break;case"enum":if(t.boolean(.1)){var i=[];for(var o in n.values)i.push(o);n.value=t.fromArray(i)}}})};var d=[new p({name:"Default",applyTo:function(e){return e.sustain.value=.2,e}}),new p({name:"Random",applyTo:function(e){var t=this.random,n=this.randomize.bind(this),a=t.int(3,16);1&a&&2&a&&n(e.attack,0,2),4&a&&(n(e.sustain,0,1),t.boolean(.5)&&n(e.sustainPunch)),8&a&&n(e.decay),t.boolean(.5)&&(n(e.tremoloDepth),n(e.tremoloFrequency)),n(e.frequency),t.boolean(.5)&&n(e.frequencySweep),t.boolean(.5)&&n(e.frequencyDeltaSweep);var i=t.int(0,3);if(i>=1&&n(e.repeatFrequency,1/(e.attack.value+e.sustain.value+e.decay.value),e.repeatFrequency.maxValue),i>=2&&(n(e.frequencyJump1Onset),n(e.frequencyJump1Amount),t.boolean(.5)&&(n(e.frequencyJump2Onset),n(e.frequencyJump2Amount),e.frequencyJump2Onset.value<e.frequencyJump1Onset.value))){var o=e.frequencyJump1Onset.value;e.frequencyJump1Onset.value=e.frequencyJump2Onset.value,e.frequencyJump2Onset.value=o}for(t.boolean(.5)&&(n(e.harmonics),n(e.harmonicsFalloff)),n(e.waveform),n(e.interpolateNoise),t.boolean(.5)&&(n(e.vibratoDepth),n(e.vibratoFrequency)),"square"==e.waveform.value&&t.boolean(.5)&&(n(e.squareDuty),n(e.squareDutySweep)),t.boolean(.5)&&(n(e.flangerOffset),t.boolean(.5)&&n(e.flangerOffsetSweep)),t.boolean(.2)&&(n(e.bitCrush),t.boolean(.5)&&n(e.bitCrushSweep));!(e.lowPassCutoff.reset(),e.lowPassCutoffSweep.reset(),e.highPassCutoff.reset(),e.highPassCutoffSweep.reset(),t.boolean(.5)&&n(e.lowPassCutoff,0,1e4),t.boolean(.5)&&n(e.highPassCutoffSweep,0,1e4),t.boolean(.5)&&n(e.highPassCutoff,0,1e4),t.boolean(.5)&&n(e.highPassCutoffSweep,0,1e4),e.lowPassCutoff.value>e.highPassCutoff.value||e.lowPassCutoff.value+e.lowPassCutoffSweep.value>e.highPassCutoff.value+e.highPassCutoffSweep.value););return t.boolean(.5)&&n(e.compression,.5,2),e.normalization.value=!0,e.amplification.value=100,e}}),new p({name:"Pickup/coin",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sine","square","whistle","breaker"]),n(e.squareDuty),n(e.squareDutySweep),n(e.sustain,.02,.1),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.05,.4),n(e.frequency,100,2e3),t.boolean(.7)&&(n(e.frequencyJump1Onset,10,30),n(e.frequencyJump1Amount,10,100),t.boolean(.3)&&(n(e.frequencyJump2Onset,20,40),n(e.frequencyJump2Amount,10,100))),t.boolean(.5)&&(n(e.flangerOffset,0,10),n(e.flangerOffsetSweep,-10,10)),e}}),new p({name:"Laser/shoot",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sine","triangle","sawtooth","square","tangent","whistle","breaker"]),n(e.squareDuty),n(e.squareDutySweep),n(e.sustain,.02,.1),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.02,.1),n(e.frequency,500,2e3),n(e.frequencySweep,-200,-2e3),n(e.frequencyDeltaSweep,-200,-2e3),t.boolean(.5)&&(n(e.vibratoDepth,0,.5*e.frequency.value),n(e.vibratoFrequency,0,100)),t.boolean(.5)&&(n(e.flangerOffset,0,10),n(e.flangerOffsetSweep,-10,10)),e}}),new p({name:"Explosion",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["whitenoise","pinknoise","brownnoise"]),n(e.interpolateNoise),n(e.sustain,.05,.1),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.3,.5),"brownnoise"==e.waveform.value?n(e.frequency,1e4,2e4):n(e.frequency,1e3,1e4),n(e.frequencySweep,-1e3,-5e3),n(e.frequencyDeltaSweep,-1e3,-5e3),t.boolean(.5)&&(n(e.tremoloDepth,0,50),n(e.tremoloFrequency,0,100)),t.boolean(.5)&&(n(e.flangerOffset,0,10),n(e.flangerOffsetSweep,-10,10)),t.boolean(.5)&&n(e.compression,.5,2),e}}),new p({name:"Powerup",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sine","triangle","sawtooth","square","tangent","whistle","breaker"]),n(e.squareDuty),n(e.squareDutySweep),n(e.sustain,.05,.2),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.1,.4),n(e.frequency,500,2e3),n(e.frequencySweep,0,2e3),n(e.frequencyDeltaSweep,0,2e3),t.boolean(.5)&&n(e.repeatFrequency,0,20),t.boolean(.5)&&(n(e.vibratoDepth),n(e.vibratoFrequency)),e}}),new p({name:"Hit/hurt",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sawtooth","square","tangent","whitenoise","pinknoise","brownnoise"]),n(e.sustain,.02,.1),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.02,.1),n(e.frequency,500,1e3),n(e.frequencySweep,-200,-1e3),n(e.frequencyDeltaSweep,-200,-1e3),t.boolean(.5)&&(n(e.flangerOffset,0,10),n(e.flangerOffsetSweep,-10,10)),n(e.lowPassCutoffSweep),e}}),new p({name:"Jump",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sine","square","whistle","breaker"]),n(e.squareDuty),n(e.squareDutySweep),n(e.sustain,.02,.1),t.boolean(.5)&&n(e.sustainPunch,0,100),n(e.decay,.05,.4),n(e.frequency,100,2e3),n(e.frequencySweep,200,2e3),t.boolean(.3)&&(n(e.flangerOffset,0,10),n(e.flangerOffsetSweep,-10,10)),t.boolean(.5)&&n(e.lowPassCutoff),t.boolean(.5)&&n(e.highPassCutoff),e}}),new p({name:"Blip/select",applyTo:function(e){var t=this.random,n=this.randomize.bind(this);return e.waveform.value=t.fromArray(["sine","triangle","sawtooth","square","tangent","whistle","breaker"]),n(e.squareDuty,10,90),n(e.sustain,.01,.07),n(e.decay,0,.03),n(e.frequency,100,3e3),t.boolean(.5)&&(n(e.harmonics),n(e.harmonicsFalloff)),e}})],m=["context","Player","$scope","$timeout","$window","localStorage","fileStorage","history","synthFactory",function(e,t,n,a,i,o,r,s,u){this.showDonateTooltip=!o.get("donated",!1)&&o.get("donateTooltipLastHidden",0)+864e5<Date.now(),this.showSafariWarning=!1,function(e){var t=new Blob(["<svg xmlns='http://www.w3.org/2000/svg'></svg>"],{type:"image/svg+xml;charset=utf-8"}),n=new Image;n.onerror=e,n.src=URL.createObjectURL(t)}(function(){this.showSafariWarning=!0}.bind(this));var l=new t;this.buffer=null,this.synth=null,this.history=s,this.analyserEnabled=o.get("analyserEnabled",!0),this.autoplay=o.get("autoplayEnabled",!0),this.createNew=o.get("createNew",!0),this.presets=d,this.link=null,this.hoveredParam=null,this.dismissDonateTooltip=function(){this.showDonateTooltip=!1,o.set("donateTooltipLastHidden",Date.now())},this.dismissDonateTooltipForever=function(){this.dismissDonateTooltip(),o.set("donated",!0)},this.getSounds=function(){return this.history.getSounds()},this.getSound=function(){return this.history.getCurrentSound()},this.currentSoundIndex=function(){return this.history.getCurrentIndex()},this.setCurrentSoundIndex=function(e){this.history.setCurrentIndex(e)},this.deleteSound=function(e){this.history.deleteSound(e)},this.isPlaying=function(){return l.playing},this.togglePlay=function(){l.playing?l.stop():l.play(this.buffer)},this.getFrequencyData=function(){return l.getFrequencyData()},this.openSound=function(){r.loadJfxr().then(function(e){this.history.addSound(e)}.bind(this),function(e){console.error("Could not load sound",e)})},this.saveSound=function(){r.saveJfxr(this.getSound(),this.getSound().name)},this.duplicateSound=function(){this.history.duplicateSound(this.history.getCurrentIndex())},this.createLink=function(){var e=document.createElement("a");e.href=window.location.href,e.hash=encodeURIComponent(this.getSound().serialize()),this.link=e.href},this.exportSound=function(){this.synth.run().then(function(e){r.downloadWav(e,this.getSound().name)}.bind(this))},this.applyPreset=function(e){var t;this.createNew?t=s.newSound(e.name):(t=this.getSound()).reset(),e.applyTo(t)},this.mutate=function(){p.mutate(this.getSound())},this.canUndo=function(){return this.history.canUndo()},this.undo=function(){this.history.undo()},this.keyDown=function(e){"INPUT"==e.target.tagName&&"text"==e.target.type||32==e.keyCode&&(this.togglePlay(),e.preventDefault())},this.soundNameKeyDown=function(e,t){switch(e.keyCode){case 13:a(function(){e.target.blur()}),e.preventDefault();break;case 27:e.target.value=t,a(function(){e.target.blur()}),e.preventDefault()}},n.$watch(function(){return this.getSounds().length}.bind(this),function(e){0===e&&this.applyPreset(this.presets[0])}.bind(this)),n.$watch(function(){return this.analyserEnabled}.bind(this),function(e){angular.isDefined(e)&&o.set("analyserEnabled",e)}),n.$watch(function(){return this.autoplay}.bind(this),function(e){angular.isDefined(e)&&o.set("autoplayEnabled",e)}),n.$watch(function(){return this.createNew}.bind(this),function(e){angular.isDefined(e)&&o.set("createNew",e)}),n.$watch(function(){return this.getSound().serialize()}.bind(this),function(t,n){this.synth&&(this.synth.cancel(),this.synth=null),l.stop(),this.buffer=null,void 0!==t&&""!==t&&(this.synth=u(t),this.synth.run().then(function(a){this.buffer=e.createBuffer(1,a.getNumSamples(),a.getSampleRate()),this.buffer.getChannelData(0).set(a.toFloat32Array()),this.autoplay&&t!==n&&l.play(this.buffer)}.bind(this)))}.bind(this)),n.$on("parammouseenter",function(e,t){this.hoveredParam=t}.bind(this)),n.$on("parammouseleave",function(e,t){this.hoveredParam=null}.bind(this)),function(){var e=decodeURIComponent(i.location.hash.replace(/^#/,""));if(i.location.hash="",e.length>0){var t=new h;try{t.parse(e)}catch(e){return void console.error("Could not parse sound from URL fragment",e)}this.history.addSound(t)}}.bind(this)()}],v=[function(){return{scope:{analyser:"=",enabled:"="},link:function(e,t,n,a){t.bind("$destroy",function(){!0});var i=t[0],o=i.getContext("2d"),r=i.width,s=i.height,u=function(){h&&(l&&function(e,t,n,a){var i=Math.max(2,Math.ceil(t/a.length)),o=Math.floor(t/i),r=Math.floor(n/3);e.clearRect(0,0,t,n);var s,u,l=e.createLinearGradient(0,0,0,n);for(l.addColorStop(0,"#f00"),l.addColorStop(.6,"#dd0"),l.addColorStop(1,"#0b0"),e.fillStyle=l,e.globalAlpha=1,s=0;s<o;s++){var h=(a[s]+100)/100;u=Math.round(h*r)/r,e.fillRect(s*i,(1-u)*n,i-1,u*n)}for(e.fillStyle="#111",e.globalAlpha=.3,s=0;s<r;s++)u=3*s+1,e.fillRect(0,u,t,1)}(o,r,s,l),window.requestAnimationFrame(u))},l=null;e.$watch("analyser",function(e){l=e});var h=!0;e.$watch("enabled",function(e){(h=e)?window.requestAnimationFrame(u):o.clearRect(0,0,r,s)})}}}],y=n(0),w=["$q",function(e){var t=function(e,t){Object(y.saveAs)(e,t)};this.downloadWav=function(e,n){var a=new Blob([e.toWavBytes()],{type:"audio/wav"});t(a,n+".wav")},this.saveJfxr=function(e,n){var a=e.serialize(),i=new Blob([a],{type:"application/json"});t(i,n+".jfxr")},this.loadJfxr=function(){return function(){var t=document.createElement("input");t.type="file";var n=e.defer();return angular.element(t).on("change",function(){var e=t.files[0];if(e){var a=new FileReader;a.addEventListener("load",function(){n.resolve({name:e.name,data:a.result})}),a.addEventListener("error",function(){n.reject(a.error)}),a.readAsText(e)}}),t.focus(),t.click(),n.promise}().then(function(e){var t=new h;return t.parse(e.data),t.name=e.name.replace(/\.jfxr$/,""),t})}}],b=["$rootScope","localStorage",function(e,t){var n=[],a=[],i=null;this.getSounds=function(){return n},this.getCurrentIndex=function(){return i},this.getCurrentSound=function(){return null===i?null:n[i]},this.setCurrentIndex=function(e){e=e||0,0!==n.length&&(i=o(0,n.length-1,e))},this.newSound=function(e){var t=new h;return t.name=r(e),this.addSound(t),t},this.addSound=function(e,t){void 0===t&&(t=0),n.splice(t,0,e),a.splice(t,0,[]),i=t},this.duplicateSound=function(e){var t=n[e].clone();t.name=r(t.name.replace(/ \d+$/,"")),this.addSound(t,e)},this.deleteSound=function(e){n.splice(e,1),a.splice(e,1),i>e&&i--,i>=n.length&&(i=n.length-1),i<0&&(i=null)},this.undo=function(){if(null!==i){var e=a[i];if(e.length>0){var t=e[e.length-1];this.getCurrentSound().parse(t)}}},this.canUndo=function(){return null!==i&&a[i].length>0};for(var r=function(e){for(var t=0,a=0;a<n.length;a++){var i=n[a].name.match("^"+e+" (\\d+)$");i&&(t=Math.max(t,parseInt(i[1])))}return e+" "+(t+1)}.bind(this),s=function(e){return"sounds["+e+"]"},u=function(e,a){void 0===a&&e<n.length&&(a=n[e].serialize()),a||(a=""),t.set(s(e),a)}.bind(this),l=0;;l++){var c=t.get(s(l),void 0);if(!c)break;var f=new h;try{f.parse(c)}catch(e){console.error("Could not parse sound from local storage",e);continue}this.addSound(f,l)}i=o(0,n.length-1,t.get("soundIndex",0)),e.$watchCollection(function(){return this.getSounds()}.bind(this),function(e,n){var a;for(a=0;a<e.length;a++)u(a);for(a=e.length;a<n.length;a++)t.delete(s(a))}.bind(this));var p=null;e.$watch(function(){return this.getCurrentSound()}.bind(this),function(t){p&&(p(),p=null),t&&(p=e.$watch(function(){return t.serialize()},function(e,t){if(u(i,e),e!=t){var n=a[i];n.length>0&&n[n.length-1]==e?n.pop():a[i].push(t)}}))}),e.$watch(function(){return this.getCurrentIndex()}.bind(this),function(e){t.set("soundIndex",e)}.bind(this))}],g=[function(){return new AudioContext}],q=["$rootScope","context",function(e,t){var n=function(){this.position=0,this.playing=!1,this.analyser=t.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.5,this.analyser.connect(t.destination),this.frequencyData=new Float32Array(this.analyser.frequencyBinCount);for(var e=0;e<this.frequencyData.length;e++)this.frequencyData[e]=-100;this.script=t.createScriptProcessor(1024),this.script.onaudioprocess=function(e){this.analyser.getFloatFrequencyData(this.frequencyData)}.bind(this),this.script.connect(this.analyser)};return n.prototype.play=function(n){t.resume().then(function(){this.playing&&this.stop(),this.source=t.createBufferSource(),this.source.connect(this.analyser),this.source.buffer=n,this.source.start(0),this.source.onended=function(){this.playing=!1,e.$apply()}.bind(this),this.playing=!0}.bind(this))},n.prototype.stop=function(){this.playing&&(this.source.stop(0),this.source.onended=null,this.source=null,this.playing=!1)},n.prototype.getFrequencyData=function(){return this.frequencyData},n}],V=[function(){var e=function(){this.data=window.localStorage||{}};return e.prototype.get=function(e,t){var n=this.data[e];return void 0===n?t:JSON.parse(n)},e.prototype.set=function(e,t){this.data[e]=JSON.stringify(t)},e.prototype.delete=function(e){this.data.removeItem(e)},new e}],S=["$q","$timeout",function(e,t){return function(n){return new x(n,t,e)}}],x=function(e,t,n){f.call(this,e,t),this.$q=n};x.prototype=Object.create(f.prototype),x.prototype.run=function(){if(this.deferred)return this.deferred.promise;this.deferred=this.$q.defer();var e=this.deferred.resolve.bind(this.deferred);return f.prototype.run.call(this,e),this.deferred.promise},x.prototype.cancel=function(){this.deferred&&(f.prototype.cancel.call(this),this.deferred.reject(),this.deferred=null)};var P=[function(){return{restrict:"E",scope:{sound:"=",param:"@"},template:'<custom-param sound="sound" param="{{param}}" value="sound[param].value">  <div class="paramcontrol">    <input type="range" min="{{ctrl.minValue}}" max="{{ctrl.maxValue}}" step="{{ctrl.step}}" ng-model="ctrl.rangeValue" ng-disabled="sound[param].isDisabled(sound)" class="floatslider"></input>  </div>  <div class="paramvalue">    <input ng-show="!sound[param].isDisabled(sound)" class="floattext" type="text" ng-model="ctrl.textValue"></input>    <span ng-show="sound[param].isDisabled(sound)">&mdash;</span>  </div>  <div class="paramunit">{{sound[param].unit}}</div></div>',controller:["$scope",function(e){function t(e){return a(e)*Math.log(Math.abs(e)+1)/Math.log(2)}this.rangeValue="",this.textValue="";var n=null,i=!1;this.minValue=0,this.maxValue=0,this.step=0,e.$watch(function(){return e.sound[e.param]},function(e){e&&((i=(n=e).logarithmic)?(this.minValue=t(n.minValue),this.maxValue=t(n.maxValue),this.step=1e-99):(this.minValue=n.minValue,this.maxValue=n.maxValue,this.step=n.step))}.bind(this)),this.getRangeValue=function(e){return i?function(e){return a(e)*(Math.pow(2,Math.abs(e))-1)}(parseFloat(this.rangeValue)):this.rangeValue},this.setRangeValue=function(e){this.rangeValue=i?t(e):e},this.getTextValue=function(e){return this.textValue},this.setTextValue=function(e){this.textValue=e},this.getParamValue=function(e){return n?n.value:null},this.setParamValue=function(e){n&&(n.value=e)},this.stepParam=function(e){if(n){var t=this.getParamValue();e=a(e),i?t-=e*n.step:t/=n.step,this.setParamValue(t)}}}],controllerAs:"ctrl",link:function(e,t,n,a){t.bind("wheel",function(t){if(!(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||t.buttons)){var n=t.deltaX+t.deltaY;a.stepParam(n),e.$apply(),t.preventDefault()}}),e.$watch(a.getParamValue.bind(a),function(e){a.setRangeValue(e),a.setTextValue(e)}),angular.element(t[0].getElementsByClassName("floatslider")).bind("input",function(t){var n=a.getRangeValue();a.setTextValue(n),a.setParamValue(n),e.$apply()});var i=angular.element(t[0].getElementsByClassName("floattext"));i.bind("blur",function(t){a.setParamValue(a.getTextValue()),a.setTextValue(a.getParamValue()),e.$apply()}),i.bind("keydown",function(e){switch(e.keyCode){case 13:i[0].blur(),e.preventDefault();break;case 27:a.setTextValue(a.getParamValue()),i[0].blur(),e.preventDefault()}})}}}],k=[function(){return{restrict:"E",scope:{sound:"=",param:"@"},template:'<custom-param sound="sound" param="{{param}}">  <div class="paramcontrol">    <label class="booleanlabel" ng-class="{\'booleanlabel-checked\': sound[param].value, \'booleanlabel-disabled\': sound[param].isDisabled(sound)}"><input type="checkbox" ng-model="sound[param].value" ng-disabled="sound[param].isDisabled(sound)"></input></label>  </div>  <div class="customparamvalue" ng-switch="sound[param].isDisabled(sound)">    <span ng-switch-when="false">{{sound[param].valueTitle()}}</span>    <span ng-switch-when="true">&mdash;</span>  </div></div>',link:function(e,t,n,i){t.bind("wheel",function(t){if(!(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||t.buttons)){var n=t.deltaX+t.deltaY;e.$apply(function(){var t=e.sound[e.param];t.value-=a(n)*t.step}),t.preventDefault()}});var o=e.$watch("sound[param].value",function(e){void 0!==e&&(t.find("input")[0].value=e,o())})}}}],R=[function(){return{require:"canvasManager",link:function(e,t,n,a){var i=null;a.registerDrawFunction(function(e,t,n){if(i){var a,o,r=i.getChannelData(0),s=i.length;if(e.strokeStyle="#fff",e.globalAlpha=.1,e.lineWidth=1,e.beginPath(),e.moveTo(0,n/2),e.lineTo(t,n/2),e.stroke(),e.strokeStyle="#57d",e.globalAlpha=1,s<t){for(e.beginPath(),a=0;a<s;a++)o=r[a],e.lineTo(a/s*t,(1-o)*n/2);e.stroke()}else for(var u=0;u<t;u++){var l=1e99,h=-1e99,c=Math.floor(u/t*s),f=Math.ceil((u+1)/t*s);for(a=c;a<f;a++)(o=r[a])<l&&(l=o),o>h&&(h=o);e.beginPath(),e.moveTo(u+.5,(1-l)*n/2-.5),e.lineTo(u+.5,(1-h)*n/2+.5),e.stroke()}}}),e.$watch(n.waveshape,function(e){i=e,a.draw()})}}}],A=[function(){return{require:"canvasManager",link:function(e,t,n,a){var i=null;a.registerDrawFunction(function(e,t,n){if(i){var a,o,r,s=i.duration(),u=0;for(a=0;a<t;a++){var l=i.frequencyAt(a/t*s);u=Math.max(u,l)}for(u-0>0?o=n-.5-0*(r=-(n-1)/(u-0)):(r=0,o=n/2),e.strokeStyle="#bb5",e.globalAlpha=1,e.lineWidth=1,e.beginPath(),a=0;a<t;a++){var h=a/t*s;e.lineTo(a,o+i.frequencyAt(h)*r)}e.stroke()}}),e.$watch(n.drawFrequency+".serialize()",function(t){i=e.$eval(n.drawFrequency),a.draw()})}}}],D=angular.module("jfxrApp",[]);D.controller("MainCtrl",m),D.directive("analyser",v),D.directive("customParam",[function(){return{restrict:"E",scope:{sound:"=",param:"@"},transclude:!0,template:'<div class="param" ng-class="{\'param-disabled\': sound[param].isDisabled(sound)}" title={{sound[param].whyDisabled(sound)}} ng-mouseenter="$emit(\'parammouseenter\', sound[param])" ng-mouseleave="$emit(\'parammouseleave\', sound[param])">  <div class="paramlabel">{{sound[param].label}}</div>  <div class="paramcontent" ng-transclude></div>  <div class="parambuttons">    <button class="iconbutton iconbutton-reset" title="Reset to default value" ng-click="sound[param].reset()" ng-disabled="sound[param].isDisabled(sound) || sound[param].hasDefaultValue()"></button>    <button class="iconbutton iconbutton-lock" ng-class="{\'iconbutton-lock-locked\': sound[param].locked}" title="Lock from mutations" ng-click="sound[param].toggleLocked()" ng-disabled="sound[param].isDisabled(sound)"></button>  </div></div>'}}]),D.directive("floatParam",P),D.directive("booleanParam",k),D.directive("waveformButton",[function(){return{require:"ngModel",scope:{title:"@",waveform:"@waveformButton",ngModel:"="},template:'<label class="waveform"        ng-class="\'waveform-\' + waveform + (checked ? \' checked\' : \'\')" title="{{title}}">  <input type="radio" name="waveform" ng-value="waveform"></input>  {{title}}</label>',link:function(e,t,n,a){var i=t.find("input"),o=e.waveform;e.$watch(function(){return i[0].checked},function(t){e.checked=t}),a.$render=function(){i[0].checked=a.$viewValue==o},i.bind("click",function(){e.$apply(function(){i[0].checked&&a.$setViewValue(o)})})}}}]),D.directive("linkbox",["$document","$timeout",function(e,t){return{scope:{for:"="},template:'<input type="text" readonly class="linkbox" ng-model="for" ng-show="for"></input>',link:function(e,n,a,i){var o=n.find("input");o.on("blur",function(){e.for=null,e.$apply()}),e.$watch("for",function(e){e&&t(function(){o[0].focus(),o[0].setSelectionRange(0,e.length)})})}}}]),D.directive("canvasManager",[function(){return{controller:["$element",function(e){var t=e[0],n=t.getContext("2d"),a=0,i=0,o=[];this.registerDrawFunction=function(e){o.push(e)},this.draw=function(){a=t.clientWidth,i=t.clientHeight,t.width!=a&&(t.width=a),t.height!=i&&(t.height=i),n.globalAlpha=1,n.clearRect(0,0,a,i);for(var e=0;e<o.length;e++)o[e](n,a,i)}}]}}]),D.directive("waveshape",R),D.directive("drawAmplitude",[function(){return{require:"canvasManager",link:function(e,t,n,a){var i=null;a.registerDrawFunction(function(e,t,n){if(i){var a=i.duration(),o=n-.5,r=-(n-1)/(1+i.sustainPunch.value/100);e.strokeStyle="#d66",e.globalAlpha=1,e.lineWidth=1,e.beginPath();for(var s=0;s<t;s++){var u=s/t*a;e.lineTo(s,o+i.amplitudeAt(u)*r)}e.stroke()}}),e.$watch(n.drawAmplitude+".serialize()",function(t){i=e.$eval(n.drawAmplitude),a.draw()})}}}]),D.directive("drawFrequency",A),D.service("context",g),D.service("fileStorage",w),D.service("history",b),D.service("Player",q),D.service("localStorage",V),D.service("synthFactory",S),function(){var e=angular.element(document.getElementById("panic")),t=function(){var e=[];return void 0!==window.Blob&&void 0!==window.FileReader&&void 0!==window.URL&&void 0!==URL.createObjectURL||e.push("File API"),void 0===window.AudioContext&&e.push("Web Audio"),void 0===window.HTMLCanvasElement&&e.push("Canvas"),e}();t.length>0?e.html("Unfortunately, jfxr cannot run in this browser because it lacks the following features: "+t.join(", ")+". Try a recent Chrome or Firefox instead."):(e.remove(),angular.element(document).ready(function(){angular.bootstrap(document,["jfxrApp"])}))}()}])});
//# sourceMappingURL=bundle.js.map