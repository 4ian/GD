<html>
<head>
  <title>Gdevelop Piskel Editor</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
   <span id="label">Status: null </span>
  <script>
  const electron = require('electron');
  const ipcRenderer = electron.ipcRenderer ;
  const path = require('path');
  const fs = require('fs');

  // function to encode file data to base64 encoded string
  function base64_encode(file) {
      // read binary data
      console.log("loading:"+file);
      var bitmap = fs.readFileSync(file);
      console.log("64STRING::  "+bitmap.toString('base64'));
      // convert binary data to base64 encoded string
      return bitmap.toString('base64');
      // return new Buffer(bitmap).toString('base64');
  }

  ipcRenderer.on('piskelAnimation',(event,imageFrames) => {
    var editorFrameEl = document.querySelector(".editor-frame");
    var pskl = editorFrameEl.contentWindow.pskl;
    let label = document.getElementById("label");
    label.innerHTML = 'errrrrrrrr ' 
    // if (pskl) {
 
      label.innerHTML = "count "+ String(imageFrames.length);
      var imageData = [];
      for (var i = 0; i < imageFrames.length; i++) {
        var imagePath = imageFrames[i];
        label.innerHTML = "loop "+ String(i);
        var image64 = new Image();
        image64.onload = function () {
          image64.src = base64_encode(imagePath);
          console.log(image64.src);
          imageData.push(image64);
        }
      };
      console.log(imageData);
      pskl.service.ImportService.prototype.createPiskelFromImages_(imageData, "foo",55, 55, false);
      // console.log(imageFrames);
    // };
    
  });
  </script>
  <iframe class="editor-frame" src="editor/index.html"></iframe>
  <script type="text/javascript" src="script.js"></script>
  
</body>
</html>