<html>
<head>
  <title>Gdevelop Piskel Editor</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
   <span id="label">Status: null </span>
  <script>
  const electron = require('electron');
  const ipcRenderer = electron.ipcRenderer ;
  const path = require('path');
  const fs = require('fs');
  const async = require('async');
 
  function base64_encode(file) {
      // read binary data
      var bitmap = fs.readFileSync(file);
      console.log("64STRING::  "+bitmap.toString('base64'));
      return "data:image/png;base64," + bitmap.toString('base64');
  }

  ipcRenderer.on('piskelAnimation',(event,imageFrames) => {
    var editorFrameEl = document.querySelector(".editor-frame");
    var pskl = editorFrameEl.contentWindow.pskl;
    let label = document.getElementById("label");
    label.innerHTML = 'errrrrrrrr ' 
    if (pskl) {
 
    label.innerHTML = "count "+ String(imageFrames.length);
    var imageData = [];      
    async.each(imageFrames, function(imagePath, callback) {
        var image64 = new Image();
        image64.onload = function () {
          imageData.push(image64);
          callback();
        }
        // This is the important part! Set src, otherwise the `onload` will not fire
        image64.src = base64_encode(imagePath);
        console.log(image64.src);
    }, function(err) {
        console.log(imageData);
        pskl.service.ImportService.prototype.createPiskelFromImages_(imageData, "foo",55, 55, false);
    });
    }
  });
  </script>
  <iframe class="editor-frame" src="editor/index.html"></iframe>
  <script type="text/javascript" src="script.js"></script>
  
</body>
</html>