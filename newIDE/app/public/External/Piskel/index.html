<html>
<head>
  <title>Gdevelop Piskel Editor</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
   <span id="label">Status: null </span>
  <script>
  const electron = require('electron');
  const ipcRenderer = electron.ipcRenderer ;
  const path = require('path');
  const fs = require('fs');
  const async = require('async');
 
  function base64_encode(file) {
      // read binary data
      var bitmap = fs.readFileSync(file);
      console.log("64STRING::  "+bitmap.toString('base64'));
      // convert binary data to base64 encoded string
      return bitmap.toString('base64');
      // return new Buffer(bitmap).toString('base64');
  }

  ipcRenderer.on('piskelAnimation',(event,imageFrames) => {
    var editorFrameEl = document.querySelector(".editor-frame");
    var pskl = editorFrameEl.contentWindow.pskl;
    let label = document.getElementById("label");
    label.innerHTML = 'errrrrrrrr ' 
    // if (pskl) {
 
    label.innerHTML = "count "+ String(imageFrames.length);
    var imageData = [];      
    async.each(imageFrames, function(file, callback) {
    // Perform operation on file here.
    console.log('Processing file ' + file);
    var image64 = new Image();
    image64.src = base64_encode(file);
    imageData.push(image64);
    console.log(String(imageData.length));
    callback();
    }, function(err) {
  // if any of the file processing produced an error, err would equal that error
    if( err ) {
      // One of the iterations produced an error.All processing will now stop.
      console.log('A file failed to process');
    } else {
      console.log('All files have been processed successfully');
      console.log(imageData);
      pskl.service.ImportService.prototype.createPiskelFromImages_(imageData, "foo",55, 55, false);
    }
  });
    
  });
  </script>
  <iframe class="editor-frame" src="editor/index.html"></iframe>
  <script type="text/javascript" src="script.js"></script>
  
</body>
</html>